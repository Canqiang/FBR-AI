2025-07-29 15:34:43,235 - clickhouse_driver.connection - WARNING - Error on socket shutdown: [Errno 57] Socket is not connected
2025-07-29 15:36:53,110 - clickhouse_driver.connection - WARNING - Failed to connect to clickhouse-0-0.umetea.net:9000
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_driver/connection.py", line 399, in connect
    return self._init_connection(host, port)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_driver/connection.py", line 329, in _init_connection
    self.socket = self._create_socket(host, port)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_driver/connection.py", line 301, in _create_socket
    raise err
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_driver/connection.py", line 292, in _create_socket
    sock.connect(sa)
TimeoutError: timed out
2025-07-29 15:40:53,318 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 15:40:53,598 - src.data.connectors - ERROR - Failed to convert to DataFrame: HTTPDriver for https://clickhouse-0-0.umetea.net:443 received ClickHouse error code 62
 Code: 62. DB::Exception: Syntax error: failed at position 515 ('%') (line 20, col 32): %(start_date)s
            AND created_at_pt < %(end_date)s
            AND pay_status = 'COMPLETED'
        
 FORMAT Native. Expected one of: CAST operator, ANY, ALL, NOT, INTERVAL, CASE, DATE, TIMESTAMP, tuple, collection of literals, array, number, literal, NULL, NULL, Bool, TRUE, FALSE, string literal, asterisk, qualified asterisk, compound identifier, list of elements, identifier, COLUMNS matcher, COLUMNS, qualified COLUMNS matcher, function name, substitution, MySQL-style global variable. (SYNTAX_ERROR) (version 24.7.3.42 (official build))

2025-07-29 15:41:48,586 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 15:43:54,159 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 15:44:32,430 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 15:44:32,738 - src.data.connectors - ERROR - Failed to convert to DataFrame: HTTPDriver for https://clickhouse-0-0.umetea.net:443 received ClickHouse error code 62
 Code: 62. DB::Exception: Syntax error: failed at position 508 ('%') (line 20, col 32): %(start_date)s
            AND created_at_pt < %(end_date)s
            AND pay_status = 'COMPLETED'
        
 FORMAT Native. Expected one of: CAST operator, ANY, ALL, NOT, INTERVAL, CASE, DATE, TIMESTAMP, tuple, collection of literals, array, number, literal, NULL, NULL, Bool, TRUE, FALSE, string literal, asterisk, qualified asterisk, compound identifier, list of elements, identifier, COLUMNS matcher, COLUMNS, qualified COLUMNS matcher, function name, substitution, MySQL-style global variable. (SYNTAX_ERROR) (version 24.7.3.42 (official build))

2025-07-29 16:16:37,508 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:21:03,540 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:21:03,547 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:21:03,547 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:21:03,547 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:22:09,847 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 16:25:09,329 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:25:09,336 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:25:09,336 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:25:09,336 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:26:15,584 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 16:27:09,345 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 16:27:12,627 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:27:12,634 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:27:12,634 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:27:12,634 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:27:18,802 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 16:28:12,642 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 16:28:16,332 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:28:16,368 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:28:16,368 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:28:16,369 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:29:08,929 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 16:29:16,375 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 16:29:19,438 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:29:19,445 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:29:19,445 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:29:19,445 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:29:25,421 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 16:30:19,452 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 16:30:22,577 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:30:22,583 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:30:22,583 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:30:22,584 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:35:01,568 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 16:35:22,638 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 16:35:25,684 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:35:25,690 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:35:25,690 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:35:25,690 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:43:13,740 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:43:13,746 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:43:13,746 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:43:13,746 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:44:14,096 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 16:47:42,417 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:47:42,425 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:47:42,425 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:47:42,425 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:47:53,770 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 16:48:51,855 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:48:51,863 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 16:48:51,871 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:48:51,877 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:48:51,877 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:48:51,877 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:48:59,807 - src.engine.core - INFO - Starting daily analysis
2025-07-29 16:48:59,809 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 16:49:01,760 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 16:49:01,989 - src.data.connectors - ERROR - Failed to convert to DataFrame: HTTPDriver for https://clickhouse-0-0.umetea.net:443 received ClickHouse error code 62
 Code: 62. DB::Exception: Syntax error: failed at position 612 ('%') (line 12, col 32): %(start_date)s
            AND created_at_pt < %(end_date)s
            AND pay_status = 'COMPLETED'
         GROUP BY date, location_id ORDER BY date DESC
 FOR. Expected one of: CAST operator, ANY, ALL, NOT, INTERVAL, CASE, DATE, TIMESTAMP, tuple, collection of literals, array, number, literal, NULL, NULL, Bool, TRUE, FALSE, string literal, asterisk, qualified asterisk, compound identifier, list of elements, identifier, COLUMNS matcher, COLUMNS, qualified COLUMNS matcher, function name, substitution, MySQL-style global variable. (SYNTAX_ERROR) (version 24.7.3.42 (official build))

2025-07-29 16:49:01,989 - src.engine.core - ERROR - Daily analysis failed: HTTPDriver for https://clickhouse-0-0.umetea.net:443 received ClickHouse error code 62
 Code: 62. DB::Exception: Syntax error: failed at position 612 ('%') (line 12, col 32): %(start_date)s
            AND created_at_pt < %(end_date)s
            AND pay_status = 'COMPLETED'
         GROUP BY date, location_id ORDER BY date DESC
 FOR. Expected one of: CAST operator, ANY, ALL, NOT, INTERVAL, CASE, DATE, TIMESTAMP, tuple, collection of literals, array, number, literal, NULL, NULL, Bool, TRUE, FALSE, string literal, asterisk, qualified asterisk, compound identifier, list of elements, identifier, COLUMNS matcher, COLUMNS, qualified COLUMNS matcher, function name, substitution, MySQL-style global variable. (SYNTAX_ERROR) (version 24.7.3.42 (official build))
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 51, in run_daily_analysis
    data = self._collect_daily_data()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 110, in _collect_daily_data
    'daily_sales': self.order_repo.get_daily_sales(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/repositories.py", line 107, in get_daily_sales
    return self.db.execute_df(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 54, in execute_df
    return self.client.query_df(query)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 406, in query_df
    return self._context_query(locals(), use_numpy=True, as_pandas=True).df_result
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 869, in _context_query
    return self._query_with_context((self.create_query_context(**kwargs)))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 243, in _query_with_context
    response = self._raw_request(body,
               ^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 481, in _raw_request
    self._error_handler(response)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 402, in _error_handler
    raise OperationalError(err_str) if retried else DatabaseError(err_str) from None
clickhouse_connect.driver.exceptions.DatabaseError: HTTPDriver for https://clickhouse-0-0.umetea.net:443 received ClickHouse error code 62
 Code: 62. DB::Exception: Syntax error: failed at position 612 ('%') (line 12, col 32): %(start_date)s
            AND created_at_pt < %(end_date)s
            AND pay_status = 'COMPLETED'
         GROUP BY date, location_id ORDER BY date DESC
 FOR. Expected one of: CAST operator, ANY, ALL, NOT, INTERVAL, CASE, DATE, TIMESTAMP, tuple, collection of literals, array, number, literal, NULL, NULL, Bool, TRUE, FALSE, string literal, asterisk, qualified asterisk, compound identifier, list of elements, identifier, COLUMNS matcher, COLUMNS, qualified COLUMNS matcher, function name, substitution, MySQL-style global variable. (SYNTAX_ERROR) (version 24.7.3.42 (official build))

2025-07-29 16:49:01,995 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 16:53:47,727 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 16:53:51,905 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 16:53:55,217 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:53:55,225 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 16:53:55,232 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:53:55,237 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:53:55,237 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:53:55,237 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:55:53,469 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 16:55:55,242 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 16:55:58,515 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:55:58,523 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 16:55:58,530 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:55:58,535 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:55:58,535 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:55:58,536 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:55:58,540 - src.engine.core - INFO - Starting daily analysis
2025-07-29 16:55:58,540 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 16:56:00,537 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 16:56:03,763 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 16:56:05,987 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 16:56:06,880 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 16:56:06,881 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 16:56:06,997 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 16:56:06,999 - src.engine.core - ERROR - Daily analysis failed: data type <class 'numpy.object_'> not inexact
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 55, in run_daily_analysis
    anomalies = self._detect_anomalies(data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 136, in _detect_anomalies
    pattern_changes = self.anomaly_detector.detect_pattern_changes(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/anomaly.py", line 128, in detect_pattern_changes
    t_stat, p_value = stats.ttest_ind(before, after)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/_lib/deprecation.py", line 234, in inner_f
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_axis_nan_policy.py", line 586, in axis_nan_policy_wrapper
    res = hypotest_fun_out(*samples, **kwds)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 6679, in ttest_ind
    v1 = _var(a, axis, ddof=1, xp=xp)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1211, in _var
    var = _moment(x, 2, axis, mean=mean, xp=xp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1193, in _moment
    a_zero_mean = _demean(a, mean, axis, xp=xp)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1132, in _demean
    eps = xp.finfo(mean.dtype).eps * 10
          ^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/numpy/core/getlimits.py", line 516, in __new__
    raise ValueError("data type %r not inexact" % (dtype))
ValueError: data type <class 'numpy.object_'> not inexact
2025-07-29 16:56:07,004 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 16:56:07,010 - src.engine.core - INFO - Starting daily analysis
2025-07-29 16:56:07,010 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 16:56:09,552 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 16:56:09,552 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 16:56:09,662 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 16:56:09,663 - src.engine.core - ERROR - Daily analysis failed: data type <class 'numpy.object_'> not inexact
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 55, in run_daily_analysis
    anomalies = self._detect_anomalies(data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 136, in _detect_anomalies
    pattern_changes = self.anomaly_detector.detect_pattern_changes(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/anomaly.py", line 128, in detect_pattern_changes
    t_stat, p_value = stats.ttest_ind(before, after)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/_lib/deprecation.py", line 234, in inner_f
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_axis_nan_policy.py", line 586, in axis_nan_policy_wrapper
    res = hypotest_fun_out(*samples, **kwds)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 6679, in ttest_ind
    v1 = _var(a, axis, ddof=1, xp=xp)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1211, in _var
    var = _moment(x, 2, axis, mean=mean, xp=xp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1193, in _moment
    a_zero_mean = _demean(a, mean, axis, xp=xp)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1132, in _demean
    eps = xp.finfo(mean.dtype).eps * 10
          ^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/numpy/core/getlimits.py", line 516, in __new__
    raise ValueError("data type %r not inexact" % (dtype))
ValueError: data type <class 'numpy.object_'> not inexact
2025-07-29 16:56:09,663 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 16:56:18,578 - src.engine.core - INFO - Starting daily analysis
2025-07-29 16:56:18,579 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 16:56:21,442 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 16:56:21,442 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 16:56:21,554 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 16:56:21,555 - src.engine.core - ERROR - Daily analysis failed: data type <class 'numpy.object_'> not inexact
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 55, in run_daily_analysis
    anomalies = self._detect_anomalies(data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 136, in _detect_anomalies
    pattern_changes = self.anomaly_detector.detect_pattern_changes(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/anomaly.py", line 128, in detect_pattern_changes
    t_stat, p_value = stats.ttest_ind(before, after)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/_lib/deprecation.py", line 234, in inner_f
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_axis_nan_policy.py", line 586, in axis_nan_policy_wrapper
    res = hypotest_fun_out(*samples, **kwds)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 6679, in ttest_ind
    v1 = _var(a, axis, ddof=1, xp=xp)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1211, in _var
    var = _moment(x, 2, axis, mean=mean, xp=xp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1193, in _moment
    a_zero_mean = _demean(a, mean, axis, xp=xp)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1132, in _demean
    eps = xp.finfo(mean.dtype).eps * 10
          ^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/numpy/core/getlimits.py", line 516, in __new__
    raise ValueError("data type %r not inexact" % (dtype))
ValueError: data type <class 'numpy.object_'> not inexact
2025-07-29 16:56:26,482 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-29 16:56:43,263 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:56:43,271 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 16:56:43,279 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 16:56:43,285 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 16:56:43,285 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 16:56:43,285 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 16:56:47,799 - src.engine.core - INFO - Starting daily analysis
2025-07-29 16:56:47,799 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 16:56:49,486 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 16:56:52,766 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 16:56:55,041 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 16:56:55,945 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 16:56:55,946 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 16:56:56,060 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 16:56:56,060 - src.engine.core - ERROR - Daily analysis failed: data type <class 'numpy.object_'> not inexact
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 55, in run_daily_analysis
    anomalies = self._detect_anomalies(data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 136, in _detect_anomalies
    pattern_changes = self.anomaly_detector.detect_pattern_changes(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/anomaly.py", line 128, in detect_pattern_changes
    t_stat, p_value = stats.ttest_ind(before, after)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/_lib/deprecation.py", line 234, in inner_f
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_axis_nan_policy.py", line 586, in axis_nan_policy_wrapper
    res = hypotest_fun_out(*samples, **kwds)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 6679, in ttest_ind
    v1 = _var(a, axis, ddof=1, xp=xp)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1211, in _var
    var = _moment(x, 2, axis, mean=mean, xp=xp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1193, in _moment
    a_zero_mean = _demean(a, mean, axis, xp=xp)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1132, in _demean
    eps = xp.finfo(mean.dtype).eps * 10
          ^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/numpy/core/getlimits.py", line 516, in __new__
    raise ValueError("data type %r not inexact" % (dtype))
ValueError: data type <class 'numpy.object_'> not inexact
2025-07-29 16:56:56,064 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 16:57:10,292 - src.engine.core - INFO - Starting daily analysis
2025-07-29 16:57:10,292 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 16:57:12,777 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 16:57:12,778 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 16:57:12,890 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 16:57:12,891 - src.engine.core - ERROR - Daily analysis failed: data type <class 'numpy.object_'> not inexact
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 55, in run_daily_analysis
    anomalies = self._detect_anomalies(data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 136, in _detect_anomalies
    pattern_changes = self.anomaly_detector.detect_pattern_changes(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/anomaly.py", line 128, in detect_pattern_changes
    t_stat, p_value = stats.ttest_ind(before, after)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/_lib/deprecation.py", line 234, in inner_f
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_axis_nan_policy.py", line 586, in axis_nan_policy_wrapper
    res = hypotest_fun_out(*samples, **kwds)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 6679, in ttest_ind
    v1 = _var(a, axis, ddof=1, xp=xp)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1211, in _var
    var = _moment(x, 2, axis, mean=mean, xp=xp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1193, in _moment
    a_zero_mean = _demean(a, mean, axis, xp=xp)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1132, in _demean
    eps = xp.finfo(mean.dtype).eps * 10
          ^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/numpy/core/getlimits.py", line 516, in __new__
    raise ValueError("data type %r not inexact" % (dtype))
ValueError: data type <class 'numpy.object_'> not inexact
2025-07-29 16:57:12,895 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 16:57:12,930 - src.engine.core - INFO - Starting daily analysis
2025-07-29 16:57:12,930 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 16:57:15,461 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 16:57:15,462 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 16:57:15,569 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 16:57:15,570 - src.engine.core - ERROR - Daily analysis failed: data type <class 'numpy.object_'> not inexact
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 55, in run_daily_analysis
    anomalies = self._detect_anomalies(data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 136, in _detect_anomalies
    pattern_changes = self.anomaly_detector.detect_pattern_changes(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/anomaly.py", line 128, in detect_pattern_changes
    t_stat, p_value = stats.ttest_ind(before, after)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/_lib/deprecation.py", line 234, in inner_f
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_axis_nan_policy.py", line 586, in axis_nan_policy_wrapper
    res = hypotest_fun_out(*samples, **kwds)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 6679, in ttest_ind
    v1 = _var(a, axis, ddof=1, xp=xp)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1211, in _var
    var = _moment(x, 2, axis, mean=mean, xp=xp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1193, in _moment
    a_zero_mean = _demean(a, mean, axis, xp=xp)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1132, in _demean
    eps = xp.finfo(mean.dtype).eps * 10
          ^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/numpy/core/getlimits.py", line 516, in __new__
    raise ValueError("data type %r not inexact" % (dtype))
ValueError: data type <class 'numpy.object_'> not inexact
2025-07-29 16:57:15,571 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 17:00:50,694 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:00:50,695 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:00:55,566 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:00:55,566 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:00:55,671 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:00:55,672 - src.engine.core - ERROR - Daily analysis failed: data type <class 'numpy.object_'> not inexact
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 55, in run_daily_analysis
    anomalies = self._detect_anomalies(data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 136, in _detect_anomalies
    pattern_changes = self.anomaly_detector.detect_pattern_changes(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/anomaly.py", line 128, in detect_pattern_changes
    t_stat, p_value = stats.ttest_ind(before, after)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/_lib/deprecation.py", line 234, in inner_f
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_axis_nan_policy.py", line 586, in axis_nan_policy_wrapper
    res = hypotest_fun_out(*samples, **kwds)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 6679, in ttest_ind
    v1 = _var(a, axis, ddof=1, xp=xp)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1211, in _var
    var = _moment(x, 2, axis, mean=mean, xp=xp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1193, in _moment
    a_zero_mean = _demean(a, mean, axis, xp=xp)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1132, in _demean
    eps = xp.finfo(mean.dtype).eps * 10
          ^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/numpy/core/getlimits.py", line 516, in __new__
    raise ValueError("data type %r not inexact" % (dtype))
ValueError: data type <class 'numpy.object_'> not inexact
2025-07-29 17:01:06,568 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-29 17:04:01,620 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:04:01,620 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:04:06,395 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:04:06,395 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:04:06,509 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:04:06,510 - src.engine.core - ERROR - Daily analysis failed: data type <class 'numpy.object_'> not inexact
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 55, in run_daily_analysis
    anomalies = self._detect_anomalies(data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 136, in _detect_anomalies
    pattern_changes = self.anomaly_detector.detect_pattern_changes(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/anomaly.py", line 128, in detect_pattern_changes
    t_stat, p_value = stats.ttest_ind(before, after)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/_lib/deprecation.py", line 234, in inner_f
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_axis_nan_policy.py", line 586, in axis_nan_policy_wrapper
    res = hypotest_fun_out(*samples, **kwds)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 6679, in ttest_ind
    v1 = _var(a, axis, ddof=1, xp=xp)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1211, in _var
    var = _moment(x, 2, axis, mean=mean, xp=xp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1193, in _moment
    a_zero_mean = _demean(a, mean, axis, xp=xp)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1132, in _demean
    eps = xp.finfo(mean.dtype).eps * 10
          ^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/numpy/core/getlimits.py", line 516, in __new__
    raise ValueError("data type %r not inexact" % (dtype))
ValueError: data type <class 'numpy.object_'> not inexact
2025-07-29 17:04:06,517 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 17:04:06,557 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:04:06,557 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:04:09,569 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:04:09,569 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:04:09,680 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:04:09,681 - src.engine.core - ERROR - Daily analysis failed: data type <class 'numpy.object_'> not inexact
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 55, in run_daily_analysis
    anomalies = self._detect_anomalies(data)
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 136, in _detect_anomalies
    pattern_changes = self.anomaly_detector.detect_pattern_changes(
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/anomaly.py", line 128, in detect_pattern_changes
    t_stat, p_value = stats.ttest_ind(before, after)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/_lib/deprecation.py", line 234, in inner_f
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_axis_nan_policy.py", line 586, in axis_nan_policy_wrapper
    res = hypotest_fun_out(*samples, **kwds)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 6679, in ttest_ind
    v1 = _var(a, axis, ddof=1, xp=xp)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1211, in _var
    var = _moment(x, 2, axis, mean=mean, xp=xp)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1193, in _moment
    a_zero_mean = _demean(a, mean, axis, xp=xp)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/scipy/stats/_stats_py.py", line 1132, in _demean
    eps = xp.finfo(mean.dtype).eps * 10
          ^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/numpy/core/getlimits.py", line 516, in __new__
    raise ValueError("data type %r not inexact" % (dtype))
ValueError: data type <class 'numpy.object_'> not inexact
2025-07-29 17:04:09,682 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 17:05:38,038 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 17:05:43,277 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 17:05:46,544 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:05:46,553 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 17:05:46,559 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:05:46,565 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 17:05:46,565 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 17:05:46,565 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 17:05:46,604 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:05:46,604 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:05:48,735 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:05:51,865 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:05:53,812 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:05:54,603 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:05:54,603 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:05:54,715 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:05:54,810 - src.engine.core - INFO - Step 3: Running predictions
2025-07-29 17:05:54,810 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 17:05:54,886 - src.engine.core - ERROR - Daily analysis failed: Found NaN in column 'y_ma'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 59, in run_daily_analysis
    predictions = self._run_predictions(data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 150, in _run_predictions
    sales_forecast = self.predictor.predict_with_prophet(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/predictive.py", line 53, in predict_with_prophet
    model.fit(data)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 1217, in fit
    model_inputs = self.preprocess(df, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 1135, in preprocess
    self.history = self.setup_dataframe(history, initialize_scales=True)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 303, in setup_dataframe
    raise ValueError(
ValueError: Found NaN in column 'y_ma'
2025-07-29 17:05:54,888 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 17:05:54,924 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:05:54,924 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:05:57,597 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:05:57,597 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:05:57,709 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:05:57,864 - src.engine.core - INFO - Step 3: Running predictions
2025-07-29 17:05:57,864 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 17:05:57,888 - src.engine.core - ERROR - Daily analysis failed: Found NaN in column 'y_ma'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 59, in run_daily_analysis
    predictions = self._run_predictions(data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 150, in _run_predictions
    sales_forecast = self.predictor.predict_with_prophet(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/predictive.py", line 53, in predict_with_prophet
    model.fit(data)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 1217, in fit
    model_inputs = self.preprocess(df, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 1135, in preprocess
    self.history = self.setup_dataframe(history, initialize_scales=True)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 303, in setup_dataframe
    raise ValueError(
ValueError: Found NaN in column 'y_ma'
2025-07-29 17:05:57,888 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 17:06:00,583 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:06:00,583 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:06:03,366 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:06:03,367 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:06:03,478 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:06:03,575 - src.engine.core - INFO - Step 3: Running predictions
2025-07-29 17:06:03,575 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 17:06:03,599 - src.engine.core - ERROR - Daily analysis failed: Found NaN in column 'y_ma'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 59, in run_daily_analysis
    predictions = self._run_predictions(data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 150, in _run_predictions
    sales_forecast = self.predictor.predict_with_prophet(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/predictive.py", line 53, in predict_with_prophet
    model.fit(data)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 1217, in fit
    model_inputs = self.preprocess(df, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 1135, in preprocess
    self.history = self.setup_dataframe(history, initialize_scales=True)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 303, in setup_dataframe
    raise ValueError(
ValueError: Found NaN in column 'y_ma'
2025-07-29 17:06:26,731 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:06:26,739 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 17:06:26,746 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:06:26,752 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 17:06:26,752 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 17:06:26,752 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 17:06:33,565 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:06:33,565 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:06:35,287 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:06:39,001 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:06:41,131 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:06:41,945 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:06:41,946 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:06:42,058 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:06:42,154 - src.engine.core - INFO - Step 3: Running predictions
2025-07-29 17:06:42,154 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 17:06:42,229 - src.engine.core - ERROR - Daily analysis failed: Found NaN in column 'y_ma'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 59, in run_daily_analysis
    predictions = self._run_predictions(data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 150, in _run_predictions
    sales_forecast = self.predictor.predict_with_prophet(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/predictive.py", line 53, in predict_with_prophet
    model.fit(data)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 1217, in fit
    model_inputs = self.preprocess(df, **kwargs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 1135, in preprocess
    self.history = self.setup_dataframe(history, initialize_scales=True)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/forecaster.py", line 303, in setup_dataframe
    raise ValueError(
ValueError: Found NaN in column 'y_ma'
2025-07-29 17:06:42,231 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 17:08:52,151 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 17:09:26,768 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 17:09:30,185 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:09:30,193 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 17:09:30,200 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:09:30,206 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 17:09:30,206 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 17:09:30,206 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 17:10:15,736 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:10:15,736 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:10:17,500 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:10:20,890 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:10:23,040 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:10:24,364 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:10:24,364 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:10:24,482 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:10:24,580 - src.engine.core - INFO - Step 3: Running predictions
2025-07-29 17:10:24,580 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 17:10:24,681 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/fxe3l0dp.json
2025-07-29 17:10:24,685 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/gk35zr3v.json
2025-07-29 17:10:24,685 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:10:24,685 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:10:24,685 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=98446', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/fxe3l0dp.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/gk35zr3v.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/prophet_modelnwe467y0/prophet_model-20250729171024.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:10:24,685 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:10:24,844 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:10:24,874 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-10 00:00:00 and 2025-07-22 00:00:00
2025-07-29 17:10:24,874 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-29 17:10:24,881 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/haustb7m.json
2025-07-29 17:10:24,884 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/s8msje7s.json
2025-07-29 17:10:24,885 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:10:24,885 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:10:24,885 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=3504', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/haustb7m.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/s8msje7s.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/prophet_model0zkjh7nh/prophet_model-20250729171024.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:10:24,885 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:10:24,907 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:10:24,931 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/v_r_ac5r.json
2025-07-29 17:10:24,934 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/zfcd2lqp.json
2025-07-29 17:10:24,934 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:10:24,934 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:10:24,934 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=61875', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/v_r_ac5r.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/zfcd2lqp.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/prophet_modelqbtwzrqx/prophet_model-20250729171024.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:10:24,934 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:10:24,951 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:10:25,077 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/94tfi2ek.json
2025-07-29 17:10:25,080 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/qj203v5j.json
2025-07-29 17:10:25,080 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:10:25,080 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:10:25,080 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=92852', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/94tfi2ek.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/qj203v5j.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/prophet_modelkulh6hdu/prophet_model-20250729171025.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:10:25,080 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:10:25,102 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:10:25,125 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/zh_w6tnl.json
2025-07-29 17:10:25,128 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/ndc95z0f.json
2025-07-29 17:10:25,128 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:10:25,128 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:10:25,128 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=82288', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/zh_w6tnl.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/ndc95z0f.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/prophet_model1bslioml/prophet_model-20250729171025.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:10:25,128 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:10:25,149 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:10:25,173 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/uk2n4c_1.json
2025-07-29 17:10:25,177 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/jzfshftu.json
2025-07-29 17:10:25,177 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:10:25,177 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:10:25,177 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=10214', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/uk2n4c_1.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/jzfshftu.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/prophet_modelqnurfgaf/prophet_model-20250729171025.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:10:25,177 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:10:25,198 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:10:25,223 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/tnhhfwss.json
2025-07-29 17:10:25,227 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/2o0i674i.json
2025-07-29 17:10:25,227 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:10:25,227 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:10:25,227 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=83534', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/tnhhfwss.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/2o0i674i.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/prophet_modeltvbrjz_3/prophet_model-20250729171025.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:10:25,227 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:10:25,251 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:10:25,274 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/14vtupc5.json
2025-07-29 17:10:25,278 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/8ofb0r67.json
2025-07-29 17:10:25,278 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:10:25,278 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:10:25,278 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=95194', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/14vtupc5.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/8ofb0r67.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpvdpkzpww/prophet_modelel2sqcdb/prophet_model-20250729171025.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:10:25,278 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:10:25,299 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:10:25,327 - src.analytics.predictive - INFO - Prophet CV MAPE: 720.44%
2025-07-29 17:10:25,328 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-29 17:10:25,423 - src.engine.core - ERROR - Daily analysis failed: All arrays must be of the same length
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 59, in run_daily_analysis
    predictions = self._run_predictions(data)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 158, in _run_predictions
    item_demand = self.predictor.predict_item_demand(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/analytics/predictive.py", line 144, in predict_item_demand
    feature_importance = pd.DataFrame({
                         ^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/frame.py", line 778, in __init__
    mgr = dict_to_mgr(data, index, columns, dtype=dtype, copy=copy, typ=manager)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/internals/construction.py", line 503, in dict_to_mgr
    return arrays_to_mgr(arrays, columns, index, dtype=dtype, typ=typ, consolidate=copy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/internals/construction.py", line 114, in arrays_to_mgr
    index = _extract_index(arrays)
            ^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/internals/construction.py", line 677, in _extract_index
    raise ValueError("All arrays must be of the same length")
ValueError: All arrays must be of the same length
2025-07-29 17:10:25,427 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 17:12:29,258 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 17:12:30,218 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 17:12:34,209 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:12:34,218 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 17:12:34,225 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:12:34,231 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 17:12:34,231 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 17:12:34,231 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 17:12:58,792 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:12:58,792 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:13:01,680 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:13:05,077 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:13:08,467 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 17:13:09,315 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:13:09,315 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:13:09,433 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:13:09,531 - src.engine.core - INFO - Step 3: Running predictions
2025-07-29 17:13:09,531 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 17:13:09,631 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/8wytqbn7.json
2025-07-29 17:13:09,635 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/a1ypkfg1.json
2025-07-29 17:13:09,636 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:13:09,636 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:13:09,636 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=93480', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/8wytqbn7.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/a1ypkfg1.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modeljd99e29m/prophet_model-20250729171309.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:13:09,636 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:13:09,671 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:13:09,700 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-10 00:00:00 and 2025-07-22 00:00:00
2025-07-29 17:13:09,700 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-29 17:13:09,707 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/uitefkbk.json
2025-07-29 17:13:09,710 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/d11k8l5s.json
2025-07-29 17:13:09,710 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:13:09,710 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:13:09,710 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=4267', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/uitefkbk.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/d11k8l5s.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model_ca1j0mi/prophet_model-20250729171309.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:13:09,710 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:13:09,733 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:13:09,757 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/kp_nhrt1.json
2025-07-29 17:13:09,760 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/hi3xc7l0.json
2025-07-29 17:13:09,761 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:13:09,761 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:13:09,761 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=41777', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/kp_nhrt1.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/hi3xc7l0.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model5h4ofv44/prophet_model-20250729171309.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:13:09,761 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:13:09,779 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:13:09,894 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/7vw9p7xt.json
2025-07-29 17:13:09,897 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/przpcxtx.json
2025-07-29 17:13:09,897 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:13:09,897 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:13:09,897 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=43255', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/7vw9p7xt.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/przpcxtx.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelvpslxi_8/prophet_model-20250729171309.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:13:09,897 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:13:09,919 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:13:09,943 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/7e4q97vj.json
2025-07-29 17:13:09,946 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/pqdcu9y3.json
2025-07-29 17:13:09,947 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:13:09,947 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:13:09,947 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=49724', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/7e4q97vj.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/pqdcu9y3.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modeljx_cv__1/prophet_model-20250729171309.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:13:09,947 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:13:09,968 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:13:09,993 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/l2v8kws9.json
2025-07-29 17:13:09,997 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/_g4_ktub.json
2025-07-29 17:13:09,997 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:13:09,997 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:13:09,997 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=28339', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/l2v8kws9.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/_g4_ktub.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelrrwa2h20/prophet_model-20250729171309.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:13:09,997 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:13:10,018 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:13:10,043 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/rjv4nn67.json
2025-07-29 17:13:10,047 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/9nron5ow.json
2025-07-29 17:13:10,047 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:13:10,047 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:13:10,047 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=57191', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/rjv4nn67.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/9nron5ow.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model4napf9gg/prophet_model-20250729171310.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:13:10,047 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:13:10,069 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:13:10,094 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/d76p4vxx.json
2025-07-29 17:13:10,097 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/3ynn90x3.json
2025-07-29 17:13:10,098 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:13:10,098 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:13:10,098 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=54561', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/d76p4vxx.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/3ynn90x3.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelexnh2a3t/prophet_model-20250729171310.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:13:10,098 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:13:10,119 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:13:10,147 - src.analytics.predictive - INFO - Prophet CV MAPE: 720.44%
2025-07-29 17:13:10,147 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-29 17:13:10,240 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-29 17:13:10,240 - src.engine.core - ERROR - Daily analysis failed: 'date'
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 63, in run_daily_analysis
    causal_results = self._run_causal_analysis(data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 174, in _run_causal_analysis
    data['promotion_effectiveness']['date']
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/frame.py", line 4107, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'date'
2025-07-29 17:13:10,245 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 17:15:33,017 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 17:15:33,070 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/8qahuuam.json
2025-07-29 17:15:33,073 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/sgd1k_zo.json
2025-07-29 17:15:33,073 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:33,073 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:33,073 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=15400', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/8qahuuam.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/sgd1k_zo.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelxe04isq6/prophet_model-20250729171533.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-29 17:15:33,073 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:33,788 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:33,812 - prophet - INFO - Making 3 forecasts with cutoffs between 2025-07-08 00:00:00 and 2025-07-22 00:00:00
2025-07-29 17:15:33,812 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-29 17:15:33,818 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/9es6dxfa.json
2025-07-29 17:15:33,820 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/e3_8moor.json
2025-07-29 17:15:33,820 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:33,820 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:33,820 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=17443', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/9es6dxfa.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/e3_8moor.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model1lozwxi3/prophet_model-20250729171533.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-29 17:15:33,820 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:34,544 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:34,566 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/kr9l8y7e.json
2025-07-29 17:15:34,568 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/k7t_vb2z.json
2025-07-29 17:15:34,568 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:34,568 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:34,568 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=79740', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/kr9l8y7e.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/k7t_vb2z.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelavs77cpb/prophet_model-20250729171534.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-29 17:15:34,568 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:35,256 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:35,280 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/sat38nbg.json
2025-07-29 17:15:35,282 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/r4ppq13v.json
2025-07-29 17:15:35,282 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:35,282 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:35,282 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=76120', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/sat38nbg.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/r4ppq13v.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelyksrkyyf/prophet_model-20250729171535.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-29 17:15:35,283 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:36,028 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:36,057 - src.analytics.predictive - INFO - Prophet CV MAPE: 805.67%
2025-07-29 17:15:36,057 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'model_performance'), 'msg': 'Field required', 'input': {'prediction_type': 'sales', 'periods': 7, 'predictions': [{'ds': Timestamp('2025-07-30 00:00:00'), 'yhat': -1468.6359114628715, 'yhat_lower': -2646.945543952162, 'yhat_upper': -253.10439538690417, 'trend': 1604.2473848446234, 'weekly': -1.114823418523713, 'yearly': -0.8006438126135306}, {'ds': Timestamp('2025-07-31 00:00:00'), 'yhat': 11371.03659349528, 'yhat_lower': 10088.287731512011, 'yhat_upper': 12632.095918866145, 'trend': 1605.653986756962, 'weekly': 6.688379999999999, 'yearly': -0.6065076369125693}, {'ds': Timestamp('2025-08-01 00:00:00'), 'yhat': -872.1544964337842, 'yhat_lower': -2177.6342488844625, 'yhat_upper': 328.6011940952903, 'trend': 1607.0605886693004, 'weekly': -1.1146365814955226, 'yearly': -0.4280651079012395}, {'ds': Timestamp('2025-08-02 00:00:00'), 'yhat': -620.7800447359326, 'yhat_lower': -1856.817013724948, 'yhat_upper': 561.7942113972528, 'trend': 1608.467190581639, 'weekly': -1.1147818431772405, 'yearly': -0.27116326553924613}, {'ds': Timestamp('2025-08-03 00:00:00'), 'yhat': -411.59581296715845, 'yhat_lower': -1629.8029533370004, 'yhat_upper': 922.6570794893859, 'trend': 1609.8737924939776, 'weekly': -1.1146884248041973, 'yearly': -0.1409811903458973}, {'ds': Timestamp('2025-08-04 00:00:00'), 'yhat': -252.37887721729305, 'yhat_lower': -1497.1528128202751, 'yhat_upper': 964.7040425037331, 'trend': 1611.2803944063162, 'weekly': -1.1147715751916776, 'yearly': -0.041860925329923714}, {'ds': Timestamp('2025-08-05 00:00:00'), 'yhat': -148.1132065096305, 'yhat_lower': -1303.8883306709968, 'yhat_upper': 1057.8505013048664, 'trend': 1612.6869963186546, 'weekly': -1.114678156814083, 'yearly': 0.022835656162850545}], 'confidence_intervals': {'lower': [-2646.945543952162, 10088.287731512011, -2177.6342488844625, -1856.817013724948, -1629.8029533370004, -1497.1528128202751, -1303.8883306709968], 'upper': [-253.10439538690417, 12632.095918866145, 328.6011940952903, 561.7942113972528, 922.6570794893859, 964.7040425037331, 1057.8505013048664]}}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'model_performance'), 'msg': 'Field required', 'input': {'prediction_type': 'sales', 'periods': 7, 'predictions': [{'ds': Timestamp('2025-07-30 00:00:00'), 'yhat': -1468.6359114628715, 'yhat_lower': -2646.945543952162, 'yhat_upper': -253.10439538690417, 'trend': 1604.2473848446234, 'weekly': -1.114823418523713, 'yearly': -0.8006438126135306}, {'ds': Timestamp('2025-07-31 00:00:00'), 'yhat': 11371.03659349528, 'yhat_lower': 10088.287731512011, 'yhat_upper': 12632.095918866145, 'trend': 1605.653986756962, 'weekly': 6.688379999999999, 'yearly': -0.6065076369125693}, {'ds': Timestamp('2025-08-01 00:00:00'), 'yhat': -872.1544964337842, 'yhat_lower': -2177.6342488844625, 'yhat_upper': 328.6011940952903, 'trend': 1607.0605886693004, 'weekly': -1.1146365814955226, 'yearly': -0.4280651079012395}, {'ds': Timestamp('2025-08-02 00:00:00'), 'yhat': -620.7800447359326, 'yhat_lower': -1856.817013724948, 'yhat_upper': 561.7942113972528, 'trend': 1608.467190581639, 'weekly': -1.1147818431772405, 'yearly': -0.27116326553924613}, {'ds': Timestamp('2025-08-03 00:00:00'), 'yhat': -411.59581296715845, 'yhat_lower': -1629.8029533370004, 'yhat_upper': 922.6570794893859, 'trend': 1609.8737924939776, 'weekly': -1.1146884248041973, 'yearly': -0.1409811903458973}, {'ds': Timestamp('2025-08-04 00:00:00'), 'yhat': -252.37887721729305, 'yhat_lower': -1497.1528128202751, 'yhat_upper': 964.7040425037331, 'trend': 1611.2803944063162, 'weekly': -1.1147715751916776, 'yearly': -0.041860925329923714}, {'ds': Timestamp('2025-08-05 00:00:00'), 'yhat': -148.1132065096305, 'yhat_lower': -1303.8883306709968, 'yhat_upper': 1057.8505013048664, 'trend': 1612.6869963186546, 'weekly': -1.114678156814083, 'yearly': 0.022835656162850545}], 'confidence_intervals': {'lower': [-2646.945543952162, 10088.287731512011, -2177.6342488844625, -1856.817013724948, -1629.8029533370004, -1497.1528128202751, -1303.8883306709968], 'upper': [-253.10439538690417, 12632.095918866145, 328.6011940952903, 561.7942113972528, 922.6570794893859, 964.7040425037331, 1057.8505013048664]}}}

2025-07-29 17:15:46,971 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:15:46,971 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:15:50,879 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:15:50,880 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:15:50,989 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:15:51,085 - src.engine.core - INFO - Step 3: Running predictions
2025-07-29 17:15:51,085 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 17:15:51,115 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/4gzcyf3c.json
2025-07-29 17:15:51,120 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/2ms8d977.json
2025-07-29 17:15:51,120 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:51,120 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:51,120 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=687', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/4gzcyf3c.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/2ms8d977.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelh2yp3g50/prophet_model-20250729171551.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:15:51,120 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:51,156 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:51,185 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-10 00:00:00 and 2025-07-22 00:00:00
2025-07-29 17:15:51,185 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-29 17:15:51,192 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/ecv7tkp4.json
2025-07-29 17:15:51,195 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/49824vi6.json
2025-07-29 17:15:51,195 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:51,195 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:51,195 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=95624', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/ecv7tkp4.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/49824vi6.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelbxx8wcd2/prophet_model-20250729171551.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:15:51,195 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:51,217 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:51,241 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/6hulbxy6.json
2025-07-29 17:15:51,244 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/psiktyb2.json
2025-07-29 17:15:51,244 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:51,244 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:51,244 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=61761', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/6hulbxy6.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/psiktyb2.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelwhq7ush1/prophet_model-20250729171551.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:15:51,244 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:51,262 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:51,286 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/p06n8m40.json
2025-07-29 17:15:51,289 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/w_i39fg5.json
2025-07-29 17:15:51,289 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:51,289 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:51,289 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=15542', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/p06n8m40.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/w_i39fg5.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelrcko2ofn/prophet_model-20250729171551.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:15:51,289 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:51,308 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:51,332 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/c_1ou37b.json
2025-07-29 17:15:51,335 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/kisi7waw.json
2025-07-29 17:15:51,336 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:51,336 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:51,336 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=12377', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/c_1ou37b.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/kisi7waw.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelh0v58p07/prophet_model-20250729171551.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:15:51,336 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:51,356 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:51,380 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/tibtm5wm.json
2025-07-29 17:15:51,383 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/antcpv0p.json
2025-07-29 17:15:51,384 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:51,384 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:51,384 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=26940', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/tibtm5wm.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/antcpv0p.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model_7doxdsq/prophet_model-20250729171551.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:15:51,384 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:51,403 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:51,427 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/9g6mrq3i.json
2025-07-29 17:15:51,431 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/5fnfy8db.json
2025-07-29 17:15:51,432 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:51,432 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:51,432 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=34315', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/9g6mrq3i.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/5fnfy8db.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model0b7pm4dv/prophet_model-20250729171551.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:15:51,432 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:51,453 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:51,476 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/mx7t83zl.json
2025-07-29 17:15:51,480 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/6zd0rtwa.json
2025-07-29 17:15:51,480 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:15:51,480 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:15:51,480 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=34219', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/mx7t83zl.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/6zd0rtwa.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modela4dl3bwi/prophet_model-20250729171551.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:15:51,480 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:15:51,500 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:15:51,525 - src.analytics.predictive - INFO - Prophet CV MAPE: 720.44%
2025-07-29 17:15:51,526 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-29 17:15:51,619 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-29 17:15:51,620 - src.engine.core - ERROR - Daily analysis failed: 'date'
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 63, in run_daily_analysis
    causal_results = self._run_causal_analysis(data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 174, in _run_causal_analysis
    data['promotion_effectiveness']['date']
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/frame.py", line 4107, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'date'
2025-07-29 17:15:51,622 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 17:16:14,868 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:16:14,869 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:16:18,278 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:16:18,278 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:16:18,390 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:16:18,483 - src.engine.core - INFO - Step 3: Running predictions
2025-07-29 17:16:18,484 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 17:16:18,516 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/3mw9_5x9.json
2025-07-29 17:16:18,520 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/iaaisy9h.json
2025-07-29 17:16:18,520 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:18,520 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:18,520 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=62019', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/3mw9_5x9.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/iaaisy9h.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model4gu49nn3/prophet_model-20250729171618.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:18,520 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:18,557 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:18,585 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-10 00:00:00 and 2025-07-22 00:00:00
2025-07-29 17:16:18,585 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-29 17:16:18,593 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/tfbhiocx.json
2025-07-29 17:16:18,595 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/7exjxgg0.json
2025-07-29 17:16:18,596 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:18,596 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:18,596 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=97140', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/tfbhiocx.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/7exjxgg0.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modeljp9cvc_m/prophet_model-20250729171618.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:18,596 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:18,616 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:18,640 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/nvqupiy5.json
2025-07-29 17:16:18,643 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/ae4br882.json
2025-07-29 17:16:18,643 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:18,643 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:18,643 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=33558', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/nvqupiy5.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/ae4br882.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model64j8q8il/prophet_model-20250729171618.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:18,643 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:18,661 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:18,685 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/zre19vo_.json
2025-07-29 17:16:18,688 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/gcxcbqp7.json
2025-07-29 17:16:18,689 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:18,689 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:18,689 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=56423', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/zre19vo_.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/gcxcbqp7.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model3uz0wq4g/prophet_model-20250729171618.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:18,689 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:18,709 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:18,733 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/ti6atohr.json
2025-07-29 17:16:18,736 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/nfpsjxkp.json
2025-07-29 17:16:18,736 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:18,736 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:18,736 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=25429', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/ti6atohr.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/nfpsjxkp.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model5s3x0cj6/prophet_model-20250729171618.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:18,736 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:18,757 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:18,781 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/49tb5l60.json
2025-07-29 17:16:18,784 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/rja0uy0c.json
2025-07-29 17:16:18,785 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:18,785 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:18,785 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=94695', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/49tb5l60.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/rja0uy0c.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model0c4decg9/prophet_model-20250729171618.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:18,785 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:18,804 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:18,828 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/ibb55tyv.json
2025-07-29 17:16:18,832 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/n1krbkju.json
2025-07-29 17:16:18,832 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:18,832 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:18,832 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=10059', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/ibb55tyv.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/n1krbkju.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelgl1huw21/prophet_model-20250729171618.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:18,832 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:18,854 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:18,881 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/bfx8r2wp.json
2025-07-29 17:16:18,885 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/8ojwyze5.json
2025-07-29 17:16:18,885 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:18,885 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:18,885 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=65429', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/bfx8r2wp.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/8ojwyze5.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modeldciu5zn1/prophet_model-20250729171618.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:18,885 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:18,908 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:18,937 - src.analytics.predictive - INFO - Prophet CV MAPE: 720.44%
2025-07-29 17:16:18,937 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-29 17:16:19,032 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-29 17:16:19,033 - src.engine.core - ERROR - Daily analysis failed: 'date'
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 63, in run_daily_analysis
    causal_results = self._run_causal_analysis(data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 174, in _run_causal_analysis
    data['promotion_effectiveness']['date']
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/frame.py", line 4107, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'date'
2025-07-29 17:16:20,880 - src.engine.core - INFO - Starting daily analysis
2025-07-29 17:16:20,880 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 17:16:25,317 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 17:16:25,317 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 17:16:25,426 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 17:16:25,520 - src.engine.core - INFO - Step 3: Running predictions
2025-07-29 17:16:25,521 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 17:16:25,550 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/rh4blugg.json
2025-07-29 17:16:25,554 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/m_focnhu.json
2025-07-29 17:16:25,555 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:25,555 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:25,555 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=59438', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/rh4blugg.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/m_focnhu.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model9xdm2nwh/prophet_model-20250729171625.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:25,555 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:25,583 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:25,613 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-10 00:00:00 and 2025-07-22 00:00:00
2025-07-29 17:16:25,613 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-29 17:16:25,620 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/lvgt4lhy.json
2025-07-29 17:16:25,623 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/5_wt7ssa.json
2025-07-29 17:16:25,623 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:25,623 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:25,623 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=32664', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/lvgt4lhy.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/5_wt7ssa.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model4929vasg/prophet_model-20250729171625.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:25,623 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:25,645 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:25,670 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/yq_5mff2.json
2025-07-29 17:16:25,673 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/eqm3n9r4.json
2025-07-29 17:16:25,673 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:25,673 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:25,673 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=43544', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/yq_5mff2.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/eqm3n9r4.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelayfoj4nm/prophet_model-20250729171625.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:25,673 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:25,692 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:25,718 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/enejb5ge.json
2025-07-29 17:16:25,721 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/_eey1_oo.json
2025-07-29 17:16:25,721 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:25,721 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:25,721 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=27101', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/enejb5ge.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/_eey1_oo.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modela_3jlvja/prophet_model-20250729171625.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:25,721 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:25,741 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:25,766 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/qtvm7b2y.json
2025-07-29 17:16:25,769 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/wloakt16.json
2025-07-29 17:16:25,770 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:25,770 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:25,770 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=99450', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/qtvm7b2y.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/wloakt16.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modelvc1c45wa/prophet_model-20250729171625.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:25,770 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:25,794 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:25,819 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/zwy5bamx.json
2025-07-29 17:16:25,822 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/j82tztal.json
2025-07-29 17:16:25,822 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:25,822 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:25,822 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=41509', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/zwy5bamx.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/j82tztal.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model1vvqiwt6/prophet_model-20250729171625.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:25,822 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:25,842 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:25,865 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/xvpe5hi3.json
2025-07-29 17:16:25,869 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/d7m5q8a2.json
2025-07-29 17:16:25,869 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:25,869 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:25,869 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=98073', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/xvpe5hi3.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/d7m5q8a2.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_model7wvb105p/prophet_model-20250729171625.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:25,869 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:25,890 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:25,914 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/k_qs6ab6.json
2025-07-29 17:16:25,918 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/y07_s9m2.json
2025-07-29 17:16:25,918 - cmdstanpy - DEBUG - idx 0
2025-07-29 17:16:25,918 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 17:16:25,918 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=9742', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/k_qs6ab6.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/y07_s9m2.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpc9y5qv5d/prophet_modeld7uxnaek/prophet_model-20250729171625.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 17:16:25,919 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 17:16:25,938 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 17:16:25,964 - src.analytics.predictive - INFO - Prophet CV MAPE: 720.44%
2025-07-29 17:16:25,964 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-29 17:16:26,055 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-29 17:16:26,055 - src.engine.core - ERROR - Daily analysis failed: 'date'
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 63, in run_daily_analysis
    causal_results = self._run_causal_analysis(data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 174, in _run_causal_analysis
    data['promotion_effectiveness']['date']
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/frame.py", line 4107, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'date'
2025-07-29 17:16:36,332 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-29 17:16:54,583 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-29 17:19:48,385 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 17:20:34,236 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 17:20:37,510 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:20:37,518 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 17:20:37,526 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:20:37,531 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 17:20:37,531 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 17:20:37,531 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 17:20:41,978 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-29 17:21:37,541 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-29 17:21:40,766 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:21:40,775 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 17:21:40,782 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 17:21:40,787 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 17:21:40,788 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 17:21:40,788 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 18:00:00,318 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 18:00:00,329 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 18:00:00,336 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 18:00:00,345 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 18:00:00,346 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 18:00:00,346 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 18:00:06,008 - src.engine.core - INFO - Starting daily analysis
2025-07-29 18:00:06,009 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 18:00:07,701 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 18:00:11,058 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 18:00:13,229 - src.data.connectors - INFO - Connected to ClickHouse: clickhouse-0-0.umetea.net:443
2025-07-29 18:00:14,004 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-29 18:00:14,004 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-29 18:00:14,123 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-29 18:00:14,222 - src.engine.core - INFO - Step 3: Running predictions
2025-07-29 18:00:14,222 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 18:00:14,320 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/l51sn3y4.json
2025-07-29 18:00:14,324 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/r1nfk62z.json
2025-07-29 18:00:14,324 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:14,324 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:14,325 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=35006', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/l51sn3y4.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/r1nfk62z.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_model1waa2uct/prophet_model-20250729180014.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 18:00:14,325 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:14,484 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:14,515 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-10 00:00:00 and 2025-07-22 00:00:00
2025-07-29 18:00:14,516 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-29 18:00:14,523 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/k7_9y2g1.json
2025-07-29 18:00:14,526 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/g74ckjkq.json
2025-07-29 18:00:14,527 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:14,527 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:14,527 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=8166', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/k7_9y2g1.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/g74ckjkq.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_modelhss68bd_/prophet_model-20250729180014.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 18:00:14,527 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:14,549 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:14,573 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/wwa7e01h.json
2025-07-29 18:00:14,576 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/im3z1oe_.json
2025-07-29 18:00:14,577 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:14,577 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:14,577 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=5259', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/wwa7e01h.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/im3z1oe_.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_modelnahjptbf/prophet_model-20250729180014.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 18:00:14,577 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:14,595 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:14,619 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/pp2bpebu.json
2025-07-29 18:00:14,622 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/6d7_g19_.json
2025-07-29 18:00:14,622 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:14,622 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:14,622 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=71322', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/pp2bpebu.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/6d7_g19_.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_model_ox8dc5p/prophet_model-20250729180014.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 18:00:14,623 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:14,642 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:14,669 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/8a6ecbpc.json
2025-07-29 18:00:14,673 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/7gf5oypb.json
2025-07-29 18:00:14,673 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:14,673 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:14,673 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=57630', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/8a6ecbpc.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/7gf5oypb.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_modeln2uh3b4p/prophet_model-20250729180014.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 18:00:14,673 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:14,694 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:14,720 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/12gmpu5v.json
2025-07-29 18:00:14,724 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/ihl3t61h.json
2025-07-29 18:00:14,724 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:14,724 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:14,724 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=62695', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/12gmpu5v.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/ihl3t61h.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_modelrs0uyll4/prophet_model-20250729180014.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 18:00:14,724 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:14,745 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:14,769 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/9u11h72q.json
2025-07-29 18:00:14,773 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/31jwnpyr.json
2025-07-29 18:00:14,774 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:14,774 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:14,774 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=86684', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/9u11h72q.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/31jwnpyr.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_model2qitj0b2/prophet_model-20250729180014.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 18:00:14,774 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:14,794 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:14,818 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/w26ropdv.json
2025-07-29 18:00:14,822 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/kj0jr4a0.json
2025-07-29 18:00:14,822 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:14,823 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:14,823 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=73044', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/w26ropdv.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/kj0jr4a0.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_model7z8uthp0/prophet_model-20250729180014.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-29 18:00:14,823 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:14,842 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:14,870 - src.analytics.predictive - INFO - Prophet CV MAPE: 720.44%
2025-07-29 18:00:14,871 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-29 18:00:14,966 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-29 18:00:14,966 - src.engine.core - ERROR - Daily analysis failed: 'date'
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3812, in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "index.pyx", line 167, in pandas._libs.index.IndexEngine.get_loc
  File "index.pyx", line 196, in pandas._libs.index.IndexEngine.get_loc
  File "pandas/_libs/hashtable_class_helper.pxi", line 7088, in pandas._libs.hashtable.PyObjectHashTable.get_item
  File "pandas/_libs/hashtable_class_helper.pxi", line 7096, in pandas._libs.hashtable.PyObjectHashTable.get_item
KeyError: 'date'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 63, in run_daily_analysis
    causal_results = self._run_causal_analysis(data)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 174, in _run_causal_analysis
    data['promotion_effectiveness']['date']
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/frame.py", line 4107, in __getitem__
    indexer = self.columns.get_loc(key)
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pandas/core/indexes/base.py", line 3819, in get_loc
    raise KeyError(key) from err
KeyError: 'date'
2025-07-29 18:00:14,970 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 18:00:19,829 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-29 18:00:19,876 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/3b2gwzbh.json
2025-07-29 18:00:19,879 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/0z01g0cr.json
2025-07-29 18:00:19,880 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:19,880 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:19,880 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=62671', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/3b2gwzbh.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/0z01g0cr.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_modeloucsepqd/prophet_model-20250729180019.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-29 18:00:19,880 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:20,606 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:20,630 - prophet - INFO - Making 3 forecasts with cutoffs between 2025-07-08 00:00:00 and 2025-07-22 00:00:00
2025-07-29 18:00:20,630 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-29 18:00:20,737 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/j9rh4ovy.json
2025-07-29 18:00:20,740 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/kk1vx8ec.json
2025-07-29 18:00:20,740 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:20,740 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:20,740 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=56299', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/j9rh4ovy.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/kk1vx8ec.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_modelatrj9mlh/prophet_model-20250729180020.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-29 18:00:20,740 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:21,470 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:21,494 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/cda7ckfx.json
2025-07-29 18:00:21,496 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/t05tptl6.json
2025-07-29 18:00:21,496 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:21,496 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:21,496 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=52042', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/cda7ckfx.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/t05tptl6.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_modeloe2zvk66/prophet_model-20250729180021.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-29 18:00:21,496 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:22,182 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:22,205 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/dg1tqrgr.json
2025-07-29 18:00:22,207 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/oskky0vk.json
2025-07-29 18:00:22,208 - cmdstanpy - DEBUG - idx 0
2025-07-29 18:00:22,208 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-29 18:00:22,208 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=69481', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/dg1tqrgr.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/oskky0vk.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp6hmrp8e4/prophet_model__pc2pv0/prophet_model-20250729180022.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-29 18:00:22,208 - cmdstanpy - INFO - Chain [1] start processing
2025-07-29 18:00:22,949 - cmdstanpy - INFO - Chain [1] done processing
2025-07-29 18:00:22,974 - src.analytics.predictive - INFO - Prophet CV MAPE: 805.67%
2025-07-29 18:00:22,975 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'model_performance'), 'msg': 'Field required', 'input': {'prediction_type': 'sales', 'periods': 7, 'predictions': [{'ds': Timestamp('2025-07-30 00:00:00'), 'yhat': -1468.6359114628715, 'yhat_lower': -2698.76792936799, 'yhat_upper': -206.47084451496164, 'trend': 1604.2473848446234, 'weekly': -1.114823418523713, 'yearly': -0.8006438126135306}, {'ds': Timestamp('2025-07-31 00:00:00'), 'yhat': 11371.03659349528, 'yhat_lower': 10144.890789084599, 'yhat_upper': 12606.65558478109, 'trend': 1605.653986756962, 'weekly': 6.688379999999999, 'yearly': -0.6065076369125693}, {'ds': Timestamp('2025-08-01 00:00:00'), 'yhat': -872.1544964337842, 'yhat_lower': -2163.6770825183853, 'yhat_upper': 306.6407316648147, 'trend': 1607.0605886693004, 'weekly': -1.1146365814955226, 'yearly': -0.4280651079012395}, {'ds': Timestamp('2025-08-02 00:00:00'), 'yhat': -620.7800447359326, 'yhat_lower': -1907.8743902230565, 'yhat_upper': 597.0105272175454, 'trend': 1608.467190581639, 'weekly': -1.1147818431772405, 'yearly': -0.27116326553924613}, {'ds': Timestamp('2025-08-03 00:00:00'), 'yhat': -411.59581296715845, 'yhat_lower': -1624.9767184204843, 'yhat_upper': 813.9164251933889, 'trend': 1609.8737924939776, 'weekly': -1.1146884248041973, 'yearly': -0.1409811903458973}, {'ds': Timestamp('2025-08-04 00:00:00'), 'yhat': -252.37887721729305, 'yhat_lower': -1501.094794101926, 'yhat_upper': 1013.7524049301958, 'trend': 1611.2803944063162, 'weekly': -1.1147715751916776, 'yearly': -0.041860925329923714}, {'ds': Timestamp('2025-08-05 00:00:00'), 'yhat': -148.1132065096305, 'yhat_lower': -1273.7919914718782, 'yhat_upper': 1151.4544312001328, 'trend': 1612.6869963186546, 'weekly': -1.114678156814083, 'yearly': 0.022835656162850545}], 'confidence_intervals': {'lower': [-2698.76792936799, 10144.890789084599, -2163.6770825183853, -1907.8743902230565, -1624.9767184204843, -1501.094794101926, -1273.7919914718782], 'upper': [-206.47084451496164, 12606.65558478109, 306.6407316648147, 597.0105272175454, 813.9164251933889, 1013.7524049301958, 1151.4544312001328]}}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'missing', 'loc': ('response', 'model_performance'), 'msg': 'Field required', 'input': {'prediction_type': 'sales', 'periods': 7, 'predictions': [{'ds': Timestamp('2025-07-30 00:00:00'), 'yhat': -1468.6359114628715, 'yhat_lower': -2698.76792936799, 'yhat_upper': -206.47084451496164, 'trend': 1604.2473848446234, 'weekly': -1.114823418523713, 'yearly': -0.8006438126135306}, {'ds': Timestamp('2025-07-31 00:00:00'), 'yhat': 11371.03659349528, 'yhat_lower': 10144.890789084599, 'yhat_upper': 12606.65558478109, 'trend': 1605.653986756962, 'weekly': 6.688379999999999, 'yearly': -0.6065076369125693}, {'ds': Timestamp('2025-08-01 00:00:00'), 'yhat': -872.1544964337842, 'yhat_lower': -2163.6770825183853, 'yhat_upper': 306.6407316648147, 'trend': 1607.0605886693004, 'weekly': -1.1146365814955226, 'yearly': -0.4280651079012395}, {'ds': Timestamp('2025-08-02 00:00:00'), 'yhat': -620.7800447359326, 'yhat_lower': -1907.8743902230565, 'yhat_upper': 597.0105272175454, 'trend': 1608.467190581639, 'weekly': -1.1147818431772405, 'yearly': -0.27116326553924613}, {'ds': Timestamp('2025-08-03 00:00:00'), 'yhat': -411.59581296715845, 'yhat_lower': -1624.9767184204843, 'yhat_upper': 813.9164251933889, 'trend': 1609.8737924939776, 'weekly': -1.1146884248041973, 'yearly': -0.1409811903458973}, {'ds': Timestamp('2025-08-04 00:00:00'), 'yhat': -252.37887721729305, 'yhat_lower': -1501.094794101926, 'yhat_upper': 1013.7524049301958, 'trend': 1611.2803944063162, 'weekly': -1.1147715751916776, 'yearly': -0.041860925329923714}, {'ds': Timestamp('2025-08-05 00:00:00'), 'yhat': -148.1132065096305, 'yhat_lower': -1273.7919914718782, 'yhat_upper': 1151.4544312001328, 'trend': 1612.6869963186546, 'weekly': -1.114678156814083, 'yearly': 0.022835656162850545}], 'confidence_intervals': {'lower': [-2698.76792936799, 10144.890789084599, -2163.6770825183853, -1907.8743902230565, -1624.9767184204843, -1501.094794101926, -1273.7919914718782], 'upper': [-206.47084451496164, 12606.65558478109, 306.6407316648147, 597.0105272175454, 813.9164251933889, 1013.7524049301958, 1151.4544312001328]}}}

2025-07-29 18:00:32,079 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-29 21:25:37,760 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 21:25:37,769 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 21:25:37,776 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 21:25:37,781 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 21:25:37,781 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 21:25:37,781 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 21:25:41,644 - src.engine.core - INFO - Starting daily analysis
2025-07-29 21:25:41,644 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 21:25:52,021 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1501d59d0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')': /?
2025-07-29 21:26:02,027 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-29 21:26:02,028 - src.data.connectors - ERROR - Failed to convert to DataFrame: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1501d5ac0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:26:02,028 - src.engine.core - ERROR - Daily analysis failed: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1501d5ac0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
TimeoutError: timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 488, in _make_request
    raise new_e
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 1093, in _validate_conn
    conn.connect()
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 753, in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 207, in _new_conn
    raise ConnectTimeoutError(
urllib3.exceptions.ConnectTimeoutError: (<urllib3.connection.HTTPSConnection object at 0x1501d5ac0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 456, in _raw_request
    response = self.http.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 143, in request
    return self.request_encode_body(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 278, in request_encode_body
    return self.urlopen(method, url, **extra_kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1501d5ac0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)'))

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 51, in run_daily_analysis
    data = self._collect_daily_data()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 110, in _collect_daily_data
    'daily_sales': self.order_repo.get_daily_sales(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/repositories.py", line 107, in get_daily_sales
    return self.db.execute_df(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 54, in execute_df
    return self.client.query_df(query)
           ^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 23, in client
    self._client = clickhouse_connect.get_client(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/__init__.py", line 122, in create_client
    return HttpClient(interface, host, port, username, password, database, access_token,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 165, in __init__
    super().__init__(database=database,
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 70, in __init__
    self._init_common_settings(apply_server_timezone)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 75, in _init_common_settings
    tuple(self.command('SELECT version(), timezone()', use_database=False))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 368, in command
    response = self._raw_request(payload, params, headers, method, fields=fields, server_wait=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 468, in _raw_request
    raise OperationalError(f'Error {ex} executing HTTP request attempt {attempts}{err_url}') from ex
clickhouse_connect.driver.exceptions.OperationalError: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1501d5ac0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:26:02,039 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 21:26:02,050 - src.engine.core - INFO - Starting daily analysis
2025-07-29 21:26:02,050 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 21:26:12,054 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x15205c110>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')': /?
2025-07-29 21:26:22,060 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-29 21:26:22,061 - src.data.connectors - ERROR - Failed to convert to DataFrame: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x15205c1d0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:26:22,061 - src.engine.core - ERROR - Daily analysis failed: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x15205c1d0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
TimeoutError: timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 488, in _make_request
    raise new_e
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 1093, in _validate_conn
    conn.connect()
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 753, in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 207, in _new_conn
    raise ConnectTimeoutError(
urllib3.exceptions.ConnectTimeoutError: (<urllib3.connection.HTTPSConnection object at 0x15205c1d0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 456, in _raw_request
    response = self.http.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 143, in request
    return self.request_encode_body(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 278, in request_encode_body
    return self.urlopen(method, url, **extra_kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x15205c1d0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)'))

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 51, in run_daily_analysis
    data = self._collect_daily_data()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 110, in _collect_daily_data
    'daily_sales': self.order_repo.get_daily_sales(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/repositories.py", line 107, in get_daily_sales
    return self.db.execute_df(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 54, in execute_df
    return self.client.query_df(query)
           ^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 23, in client
    self._client = clickhouse_connect.get_client(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/__init__.py", line 122, in create_client
    return HttpClient(interface, host, port, username, password, database, access_token,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 165, in __init__
    super().__init__(database=database,
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 70, in __init__
    self._init_common_settings(apply_server_timezone)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 75, in _init_common_settings
    tuple(self.command('SELECT version(), timezone()', use_database=False))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 368, in command
    response = self._raw_request(payload, params, headers, method, fields=fields, server_wait=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 468, in _raw_request
    raise OperationalError(f'Error {ex} executing HTTP request attempt {attempts}{err_url}') from ex
clickhouse_connect.driver.exceptions.OperationalError: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x15205c1d0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:26:22,072 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 21:26:37,376 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 21:26:37,385 - src.api.app - INFO - Starting AI Growth Engine API
2025-07-29 21:26:37,405 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-29 21:26:37,411 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-29 21:26:37,411 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-29 21:26:37,412 - src.engine.scheduler - INFO - Task scheduler started
2025-07-29 21:26:41,235 - src.engine.core - INFO - Starting daily analysis
2025-07-29 21:26:41,235 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 21:26:51,241 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1655d6ba0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')': /?
2025-07-29 21:27:01,247 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-29 21:27:01,247 - src.data.connectors - ERROR - Failed to convert to DataFrame: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1655d6c90>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:27:01,247 - src.engine.core - ERROR - Daily analysis failed: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1655d6c90>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
TimeoutError: timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 488, in _make_request
    raise new_e
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 1093, in _validate_conn
    conn.connect()
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 753, in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 207, in _new_conn
    raise ConnectTimeoutError(
urllib3.exceptions.ConnectTimeoutError: (<urllib3.connection.HTTPSConnection object at 0x1655d6c90>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 456, in _raw_request
    response = self.http.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 143, in request
    return self.request_encode_body(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 278, in request_encode_body
    return self.urlopen(method, url, **extra_kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1655d6c90>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)'))

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 51, in run_daily_analysis
    data = self._collect_daily_data()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 110, in _collect_daily_data
    'daily_sales': self.order_repo.get_daily_sales(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/repositories.py", line 107, in get_daily_sales
    return self.db.execute_df(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 54, in execute_df
    return self.client.query_df(query)
           ^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 23, in client
    self._client = clickhouse_connect.get_client(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/__init__.py", line 122, in create_client
    return HttpClient(interface, host, port, username, password, database, access_token,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 165, in __init__
    super().__init__(database=database,
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 70, in __init__
    self._init_common_settings(apply_server_timezone)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 75, in _init_common_settings
    tuple(self.command('SELECT version(), timezone()', use_database=False))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 368, in command
    response = self._raw_request(payload, params, headers, method, fields=fields, server_wait=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 468, in _raw_request
    raise OperationalError(f'Error {ex} executing HTTP request attempt {attempts}{err_url}') from ex
clickhouse_connect.driver.exceptions.OperationalError: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1655d6c90>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:27:01,256 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 21:27:01,288 - src.engine.core - INFO - Starting daily analysis
2025-07-29 21:27:01,288 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 21:27:11,294 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x166260800>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')': /?
2025-07-29 21:27:21,301 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-29 21:27:21,301 - src.data.connectors - ERROR - Failed to convert to DataFrame: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1662600b0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:27:21,301 - src.engine.core - ERROR - Daily analysis failed: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1662600b0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
TimeoutError: timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 488, in _make_request
    raise new_e
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 1093, in _validate_conn
    conn.connect()
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 753, in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 207, in _new_conn
    raise ConnectTimeoutError(
urllib3.exceptions.ConnectTimeoutError: (<urllib3.connection.HTTPSConnection object at 0x1662600b0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 456, in _raw_request
    response = self.http.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 143, in request
    return self.request_encode_body(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 278, in request_encode_body
    return self.urlopen(method, url, **extra_kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1662600b0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)'))

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 51, in run_daily_analysis
    data = self._collect_daily_data()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 110, in _collect_daily_data
    'daily_sales': self.order_repo.get_daily_sales(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/repositories.py", line 107, in get_daily_sales
    return self.db.execute_df(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 54, in execute_df
    return self.client.query_df(query)
           ^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 23, in client
    self._client = clickhouse_connect.get_client(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/__init__.py", line 122, in create_client
    return HttpClient(interface, host, port, username, password, database, access_token,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 165, in __init__
    super().__init__(database=database,
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 70, in __init__
    self._init_common_settings(apply_server_timezone)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 75, in _init_common_settings
    tuple(self.command('SELECT version(), timezone()', use_database=False))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 368, in command
    response = self._raw_request(payload, params, headers, method, fields=fields, server_wait=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 468, in _raw_request
    raise OperationalError(f'Error {ex} executing HTTP request attempt {attempts}{err_url}') from ex
clickhouse_connect.driver.exceptions.OperationalError: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x1662600b0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:27:21,306 - src.api.app - ERROR - Global exception: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 78, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/starlette/routing.py", line 75, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 328, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/fastapi/routing.py", line 177, in serialize_response
    raise ResponseValidationError(
fastapi.exceptions.ResponseValidationError: 1 validation errors:
  {'type': 'list_type', 'loc': ('response', 'anomalies'), 'msg': 'Input should be a valid list', 'input': {}}

2025-07-29 21:27:21,362 - src.engine.core - INFO - Starting daily analysis
2025-07-29 21:27:21,362 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 21:27:31,365 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x166261eb0>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')': /?
2025-07-29 21:27:41,370 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-29 21:27:41,371 - src.data.connectors - ERROR - Failed to convert to DataFrame: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x166261f70>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:27:41,371 - src.engine.core - ERROR - Daily analysis failed: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x166261f70>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
TimeoutError: timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 488, in _make_request
    raise new_e
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 1093, in _validate_conn
    conn.connect()
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 753, in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 207, in _new_conn
    raise ConnectTimeoutError(
urllib3.exceptions.ConnectTimeoutError: (<urllib3.connection.HTTPSConnection object at 0x166261f70>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 456, in _raw_request
    response = self.http.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 143, in request
    return self.request_encode_body(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 278, in request_encode_body
    return self.urlopen(method, url, **extra_kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x166261f70>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)'))

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 51, in run_daily_analysis
    data = self._collect_daily_data()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 110, in _collect_daily_data
    'daily_sales': self.order_repo.get_daily_sales(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/repositories.py", line 107, in get_daily_sales
    return self.db.execute_df(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 54, in execute_df
    return self.client.query_df(query)
           ^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 23, in client
    self._client = clickhouse_connect.get_client(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/__init__.py", line 122, in create_client
    return HttpClient(interface, host, port, username, password, database, access_token,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 165, in __init__
    super().__init__(database=database,
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 70, in __init__
    self._init_common_settings(apply_server_timezone)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 75, in _init_common_settings
    tuple(self.command('SELECT version(), timezone()', use_database=False))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 368, in command
    response = self._raw_request(payload, params, headers, method, fields=fields, server_wait=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 468, in _raw_request
    raise OperationalError(f'Error {ex} executing HTTP request attempt {attempts}{err_url}') from ex
clickhouse_connect.driver.exceptions.OperationalError: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x166261f70>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:27:41,399 - src.engine.core - INFO - Starting daily analysis
2025-07-29 21:27:41,399 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 21:27:51,418 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x166261670>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')': /?
2025-07-29 21:28:01,423 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-29 21:28:01,423 - src.data.connectors - ERROR - Failed to convert to DataFrame: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x166261c40>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:28:01,424 - src.engine.core - ERROR - Daily analysis failed: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x166261c40>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
TimeoutError: timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 488, in _make_request
    raise new_e
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 1093, in _validate_conn
    conn.connect()
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 753, in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 207, in _new_conn
    raise ConnectTimeoutError(
urllib3.exceptions.ConnectTimeoutError: (<urllib3.connection.HTTPSConnection object at 0x166261c40>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 456, in _raw_request
    response = self.http.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 143, in request
    return self.request_encode_body(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 278, in request_encode_body
    return self.urlopen(method, url, **extra_kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x166261c40>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)'))

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 51, in run_daily_analysis
    data = self._collect_daily_data()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 110, in _collect_daily_data
    'daily_sales': self.order_repo.get_daily_sales(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/repositories.py", line 107, in get_daily_sales
    return self.db.execute_df(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 54, in execute_df
    return self.client.query_df(query)
           ^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 23, in client
    self._client = clickhouse_connect.get_client(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/__init__.py", line 122, in create_client
    return HttpClient(interface, host, port, username, password, database, access_token,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 165, in __init__
    super().__init__(database=database,
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 70, in __init__
    self._init_common_settings(apply_server_timezone)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 75, in _init_common_settings
    tuple(self.command('SELECT version(), timezone()', use_database=False))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 368, in command
    response = self._raw_request(payload, params, headers, method, fields=fields, server_wait=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 468, in _raw_request
    raise OperationalError(f'Error {ex} executing HTTP request attempt {attempts}{err_url}') from ex
clickhouse_connect.driver.exceptions.OperationalError: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x166261c40>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:28:11,183 - src.engine.core - INFO - Starting daily analysis
2025-07-29 21:28:11,184 - src.engine.core - INFO - Step 1: Collecting data
2025-07-29 21:28:21,194 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x16627c080>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')': /?
2025-07-29 21:28:31,203 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-29 21:28:31,204 - src.data.connectors - ERROR - Failed to convert to DataFrame: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x16627c230>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:28:31,205 - src.engine.core - ERROR - Daily analysis failed: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x16627c230>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 198, in _new_conn
    sock = connection.create_connection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 85, in create_connection
    raise err
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/connection.py", line 73, in create_connection
    sock.connect(sa)
TimeoutError: timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
               ^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 488, in _make_request
    raise new_e
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 464, in _make_request
    self._validate_conn(conn)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 1093, in _validate_conn
    conn.connect()
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 753, in connect
    self.sock = sock = self._new_conn()
                       ^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connection.py", line 207, in _new_conn
    raise ConnectTimeoutError(
urllib3.exceptions.ConnectTimeoutError: (<urllib3.connection.HTTPSConnection object at 0x16627c230>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 456, in _raw_request
    response = self.http.request(method, url, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 143, in request
    return self.request_encode_body(
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/_request_methods.py", line 278, in request_encode_body
    return self.urlopen(method, url, **extra_kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/poolmanager.py", line 459, in urlopen
    response = conn.urlopen(method, u.request_uri, **kw)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 871, in urlopen
    return self.urlopen(
           ^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
              ^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/urllib3/util/retry.py", line 519, in increment
    raise MaxRetryError(_pool, url, reason) from reason  # type: ignore[arg-type]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
urllib3.exceptions.MaxRetryError: HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x16627c230>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)'))

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 51, in run_daily_analysis
    data = self._collect_daily_data()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 110, in _collect_daily_data
    'daily_sales': self.order_repo.get_daily_sales(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/repositories.py", line 107, in get_daily_sales
    return self.db.execute_df(query, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 54, in execute_df
    return self.client.query_df(query)
           ^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/data/connectors.py", line 23, in client
    self._client = clickhouse_connect.get_client(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/__init__.py", line 122, in create_client
    return HttpClient(interface, host, port, username, password, database, access_token,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 165, in __init__
    super().__init__(database=database,
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 70, in __init__
    self._init_common_settings(apply_server_timezone)
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/client.py", line 75, in _init_common_settings
    tuple(self.command('SELECT version(), timezone()', use_database=False))
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 368, in command
    response = self._raw_request(payload, params, headers, method, fields=fields, server_wait=False)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/clickhouse_connect/driver/httpclient.py", line 468, in _raw_request
    raise OperationalError(f'Error {ex} executing HTTP request attempt {attempts}{err_url}') from ex
clickhouse_connect.driver.exceptions.OperationalError: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by ConnectTimeoutError(<urllib3.connection.HTTPSConnection object at 0x16627c230>, 'Connection to clickhouse-0-0.umetea.net timed out. (connect timeout=10)')) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-29 21:28:33,556 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-29 21:36:03,068 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-30 10:40:55,755 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:40:56,385 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:40:56,385 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:40:56,385 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:40:56,385 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 10:40:56,896 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:40:57,432 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:40:57,432 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:40:57,432 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:40:57,433 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 10:40:57,920 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:40:58,385 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:40:58,386 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:40:58,386 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:40:58,386 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 10:40:58,386 - src.api.app - INFO - Engine initialized successfully
2025-07-30 10:40:58,398 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 10:40:58,398 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 10:40:58,398 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 10:40:58,398 - src.api.app - INFO - Scheduler started successfully
2025-07-30 10:41:04,268 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:41:04,808 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:41:04,808 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:41:04,808 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:41:04,808 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 10:41:05,271 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:41:05,728 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:41:05,728 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:41:05,728 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:41:05,729 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 10:41:06,215 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:41:06,727 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:41:06,727 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:41:06,728 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:41:06,728 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 10:41:06,728 - src.api.app - INFO - Engine initialized successfully
2025-07-30 10:41:06,740 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 10:41:06,740 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 10:41:06,741 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 10:41:06,741 - src.api.app - INFO - Scheduler started successfully
2025-07-30 10:41:13,555 - src.api.routes - INFO - Running new daily analysis
2025-07-30 10:41:13,556 - src.engine.core - INFO - Starting daily analysis
2025-07-30 10:41:13,556 - src.engine.core - INFO - Step 1: Collecting data
2025-07-30 10:41:13,556 - src.data.mock_repository - INFO - Generating mock daily sales data from 2025-05-01 10:41:13.556229 to 2025-07-30 10:41:13.556229
2025-07-30 10:41:13,563 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 10:41:13,567 - src.data.mock_repository - INFO - Generating mock customer segments data
2025-07-30 10:41:13,568 - src.data.mock_repository - INFO - Generating mock time series data for 180 days
2025-07-30 10:41:13,571 - src.data.mock_repository - INFO - Generating mock promotion effectiveness data for 30 days
2025-07-30 10:41:13,573 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-30 10:41:13,574 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-30 10:41:13,642 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-30 10:41:13,761 - src.engine.core - INFO - Step 3: Running predictions
2025-07-30 10:41:13,761 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 10:41:13,860 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/8ci7ptso.json
2025-07-30 10:41:13,864 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/fz9uhirh.json
2025-07-30 10:41:13,864 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:41:13,864 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:41:13,864 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=2417', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/8ci7ptso.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/fz9uhirh.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/prophet_modelwm56k4_s/prophet_model-20250730104113.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:41:13,864 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:41:14,025 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:41:14,056 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-11 10:41:13.568429 and 2025-07-23 10:41:13.568429
2025-07-30 10:41:14,056 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 10:41:14,063 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/pge3tnqb.json
2025-07-30 10:41:14,066 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/351jnnam.json
2025-07-30 10:41:14,067 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:41:14,067 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:41:14,067 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=42689', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/pge3tnqb.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/351jnnam.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/prophet_model0vbdlewd/prophet_model-20250730104114.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:41:14,067 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:41:14,080 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:41:14,105 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/4ei6im88.json
2025-07-30 10:41:14,108 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/df080_hj.json
2025-07-30 10:41:14,109 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:41:14,109 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:41:14,109 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=64021', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/4ei6im88.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/df080_hj.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/prophet_model9lvh9jgf/prophet_model-20250730104114.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:41:14,109 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:41:14,121 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:41:14,145 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/lterck14.json
2025-07-30 10:41:14,148 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/o3f9qd3o.json
2025-07-30 10:41:14,149 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:41:14,149 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:41:14,149 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=13919', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/lterck14.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/o3f9qd3o.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/prophet_modelrh43qt2s/prophet_model-20250730104114.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:41:14,149 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:41:14,162 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:41:14,186 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/kjlzn22y.json
2025-07-30 10:41:14,189 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/mxb0jlux.json
2025-07-30 10:41:14,189 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:41:14,189 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:41:14,189 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=34039', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/kjlzn22y.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/mxb0jlux.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/prophet_model7q2478bd/prophet_model-20250730104114.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:41:14,189 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:41:14,206 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:41:14,230 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/afbpmo72.json
2025-07-30 10:41:14,234 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/itm_gnbh.json
2025-07-30 10:41:14,234 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:41:14,234 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:41:14,234 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=1355', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/afbpmo72.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/itm_gnbh.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/prophet_model5cwxeayv/prophet_model-20250730104114.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:41:14,234 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:41:14,250 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:41:14,275 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/ufdk5e21.json
2025-07-30 10:41:14,278 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/4f1vy5da.json
2025-07-30 10:41:14,279 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:41:14,279 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:41:14,279 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=94745', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/ufdk5e21.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/4f1vy5da.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/prophet_model_h6f_n_9/prophet_model-20250730104114.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:41:14,279 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:41:14,296 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:41:14,320 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/2k9cwm59.json
2025-07-30 10:41:14,324 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/insqi2gh.json
2025-07-30 10:41:14,324 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:41:14,324 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:41:14,324 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=38237', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/2k9cwm59.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/insqi2gh.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpyd1cyig_/prophet_modelmmigemwc/prophet_model-20250730104114.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:41:14,324 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:41:14,340 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:41:14,371 - src.analytics.predictive - INFO - Prophet CV MAPE: 4.81%
2025-07-30 10:41:14,372 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-30 10:41:14,467 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-30 10:41:14,468 - src.analytics.causal - INFO - Analyzing causal effect of has_promotion on revenue
2025-07-30 10:41:14,509 - dowhy.causal_model - INFO - Model to find the causal effect of treatment ['has_promotion'] on outcome ['revenue']
2025-07-30 10:41:14,510 - dowhy.causal_model - WARNING - There are an additional 10 variables in the dataset that are not in the graph. Variable names are: '['avg_order_value', 'customer_count', 'date', 'hour_of_day', 'location_id', 'location_name', 'new_customer_count', 'order_count', 'repeat_customer_count', 'total_revenue']'
2025-07-30 10:41:14,511 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 10:41:14,513 - dowhy.causal_identifier.auto_identifier - INFO - Instrumental variables for treatment and outcome:[]
2025-07-30 10:41:14,513 - dowhy.causal_identifier.auto_identifier - INFO - Frontdoor variables for treatment and outcome:[]
2025-07-30 10:41:14,513 - dowhy.causal_identifier.auto_identifier - INFO - Number of general adjustment sets found: 1
2025-07-30 10:41:14,513 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 10:41:14,513 - dowhy.causal_model - INFO - propensity_score_matching
2025-07-30 10:41:14,514 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Matching Estimator
2025-07-30 10:41:14,515 - src.analytics.causal - WARNING - PSM estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 10:41:14,515 - dowhy.causal_model - INFO - propensity_score_weighting
2025-07-30 10:41:14,516 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Weighting Estimator
2025-07-30 10:41:14,517 - src.analytics.causal - WARNING - IPW estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 10:41:14,517 - dowhy.causal_model - INFO - linear_regression
2025-07-30 10:41:14,517 - dowhy.causal_estimator - INFO - INFO: Using Linear Regression Estimator
2025-07-30 10:41:14,517 - dowhy.causal_estimator - INFO - b: revenue~has_promotion+is_weekend
2025-07-30 10:41:14,523 - src.analytics.causal - WARNING - Placebo test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 10:41:14,523 - src.analytics.causal - WARNING - Random common cause test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 10:41:14,523 - src.engine.core - INFO - Step 5: Generating optimizations
2025-07-30 10:41:14,524 - src.analytics.optimization - INFO - Optimizing pricing strategy
2025-07-30 10:41:14,525 - src.engine.core - ERROR - Failed to generate pricing optimization: 'item_total_amt'
2025-07-30 10:41:14,525 - src.engine.core - INFO - Step 6: Generating AI insights
2025-07-30 10:41:15,036 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 10:41:16,526 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 403 Forbidden"
2025-07-30 10:41:16,529 - src.llm.azure_client - ERROR - LLM Error: Error code: 403 - {'error': {'code': '403', 'message': 'Access denied due to Virtual Network/Firewall rules.'}}
2025-07-30 10:41:16,529 - src.engine.core - ERROR - Failed to generate daily report: Error code: 403 - {'error': {'code': '403', 'message': 'Access denied due to Virtual Network/Firewall rules.'}}
2025-07-30 10:41:16,532 - src.engine.core - ERROR - Failed to generate problem diagnosis: 1 validation error for SequentialChain
  Value error, Missing required input keys: {'format_instructions'}, only had {'historical_context', 'decline_analysis', 'factors', 'decline_pct', 'period'} [type=value_error, input_value={'chains': [LLMChain(verb...ions'], 'verbose': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
2025-07-30 10:41:16,805 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 403 Forbidden"
2025-07-30 10:41:16,807 - src.llm.azure_client - ERROR - LLM Error: Error code: 403 - {'error': {'code': '403', 'message': 'Access denied due to Virtual Network/Firewall rules.'}}
2025-07-30 10:41:16,807 - src.engine.core - ERROR - Failed to generate customer insights: Error code: 403 - {'error': {'code': '403', 'message': 'Access denied due to Virtual Network/Firewall rules.'}}
2025-07-30 10:41:16,807 - src.engine.core - INFO - Daily analysis completed in 3.25 seconds
2025-07-30 10:44:53,280 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 10:45:06,757 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 10:45:10,545 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:45:12,009 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:45:12,009 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:45:12,009 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:45:12,009 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 10:45:12,592 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:45:13,049 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:45:13,049 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:45:13,049 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:45:13,049 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 10:45:13,513 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:45:13,965 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:45:13,965 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:45:13,965 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:45:13,965 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 10:45:13,965 - src.api.app - INFO - Engine initialized successfully
2025-07-30 10:45:13,970 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 10:45:13,970 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 10:45:13,970 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 10:45:13,970 - src.api.app - INFO - Scheduler started successfully
2025-07-30 10:46:35,165 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 10:47:13,979 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 10:47:17,215 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:47:17,673 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:47:17,674 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:47:17,674 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:47:17,675 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 10:47:18,139 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:47:18,587 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:47:18,587 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:47:18,587 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:47:18,587 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 10:47:19,041 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:47:19,490 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:47:19,490 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:47:19,490 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:47:19,491 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 10:47:19,491 - src.api.app - INFO - Engine initialized successfully
2025-07-30 10:47:19,497 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 10:47:19,497 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 10:47:19,497 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 10:47:19,498 - src.api.app - INFO - Scheduler started successfully
2025-07-30 10:47:19,506 - src.api.routes - INFO - Running new daily analysis
2025-07-30 10:47:19,506 - src.engine.core - INFO - Starting daily analysis
2025-07-30 10:47:19,506 - src.engine.core - INFO - Step 1: Collecting data
2025-07-30 10:47:19,506 - src.data.mock_repository - INFO - Generating mock daily sales data from 2025-05-01 10:47:19.506331 to 2025-07-30 10:47:19.506331
2025-07-30 10:47:19,507 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 10:47:19,508 - src.data.mock_repository - INFO - Generating mock customer segments data
2025-07-30 10:47:19,508 - src.data.mock_repository - INFO - Generating mock time series data for 180 days
2025-07-30 10:47:19,509 - src.data.mock_repository - INFO - Generating mock promotion effectiveness data for 30 days
2025-07-30 10:47:19,510 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-30 10:47:19,510 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-30 10:47:19,567 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-30 10:47:19,663 - src.engine.core - INFO - Step 3: Running predictions
2025-07-30 10:47:19,663 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 10:47:19,745 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/8hiok0kb.json
2025-07-30 10:47:19,749 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/5ucjm01j.json
2025-07-30 10:47:19,749 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:47:19,749 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:47:19,749 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=47806', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/8hiok0kb.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/5ucjm01j.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_modelfzodbhmc/prophet_model-20250730104719.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:47:19,749 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:47:19,774 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:47:19,802 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-11 10:47:19.508813 and 2025-07-23 10:47:19.508813
2025-07-30 10:47:19,802 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 10:47:19,810 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/8yg_rb8v.json
2025-07-30 10:47:19,812 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/91ixtw2a.json
2025-07-30 10:47:19,813 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:47:19,813 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:47:19,813 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=39055', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/8yg_rb8v.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/91ixtw2a.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_modelfpofktc1/prophet_model-20250730104719.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:47:19,813 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:47:19,829 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:47:19,853 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/vy_77soh.json
2025-07-30 10:47:19,856 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/5mwzk1aq.json
2025-07-30 10:47:19,856 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:47:19,856 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:47:19,856 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=22318', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/vy_77soh.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/5mwzk1aq.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_modelkmfwnc1z/prophet_model-20250730104719.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:47:19,856 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:47:19,873 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:47:19,897 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/ar98o0e1.json
2025-07-30 10:47:19,901 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/weupkgza.json
2025-07-30 10:47:19,901 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:47:19,901 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:47:19,901 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=7615', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/ar98o0e1.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/weupkgza.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_model6dr_lqn4/prophet_model-20250730104719.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:47:19,901 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:47:19,918 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:47:19,942 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/s3jjqqxx.json
2025-07-30 10:47:19,945 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/f48ih2lu.json
2025-07-30 10:47:19,945 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:47:19,945 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:47:19,945 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=15824', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/s3jjqqxx.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/f48ih2lu.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_modelithrhvh7/prophet_model-20250730104719.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:47:19,945 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:47:19,960 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:47:19,983 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/kijt370m.json
2025-07-30 10:47:19,987 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/d9ggh1uk.json
2025-07-30 10:47:19,987 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:47:19,987 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:47:19,987 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=42161', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/kijt370m.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/d9ggh1uk.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_model82ftr9wt/prophet_model-20250730104719.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:47:19,987 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:47:20,003 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:47:20,031 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/rpg996pl.json
2025-07-30 10:47:20,034 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/oolxn2i4.json
2025-07-30 10:47:20,034 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:47:20,034 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:47:20,034 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=51662', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/rpg996pl.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/oolxn2i4.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_modelh3v1wfmu/prophet_model-20250730104720.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:47:20,034 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:47:20,053 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:47:20,078 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/0ubjjgf2.json
2025-07-30 10:47:20,081 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/xjmwr3ia.json
2025-07-30 10:47:20,082 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:47:20,082 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:47:20,082 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=91670', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/0ubjjgf2.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/xjmwr3ia.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_modelc8y6j7pb/prophet_model-20250730104720.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:47:20,082 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:47:20,099 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:47:20,126 - src.analytics.predictive - INFO - Prophet CV MAPE: 8.48%
2025-07-30 10:47:20,126 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-30 10:47:20,216 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-30 10:47:20,217 - src.analytics.causal - INFO - Analyzing causal effect of has_promotion on revenue
2025-07-30 10:47:20,230 - dowhy.causal_model - INFO - Model to find the causal effect of treatment ['has_promotion'] on outcome ['revenue']
2025-07-30 10:47:20,231 - dowhy.causal_model - WARNING - There are an additional 10 variables in the dataset that are not in the graph. Variable names are: '['avg_order_value', 'customer_count', 'date', 'hour_of_day', 'location_id', 'location_name', 'new_customer_count', 'order_count', 'repeat_customer_count', 'total_revenue']'
2025-07-30 10:47:20,231 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 10:47:20,233 - dowhy.causal_identifier.auto_identifier - INFO - Instrumental variables for treatment and outcome:[]
2025-07-30 10:47:20,233 - dowhy.causal_identifier.auto_identifier - INFO - Frontdoor variables for treatment and outcome:[]
2025-07-30 10:47:20,233 - dowhy.causal_identifier.auto_identifier - INFO - Number of general adjustment sets found: 1
2025-07-30 10:47:20,233 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 10:47:20,233 - dowhy.causal_model - INFO - propensity_score_matching
2025-07-30 10:47:20,234 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Matching Estimator
2025-07-30 10:47:20,235 - src.analytics.causal - WARNING - PSM estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 10:47:20,235 - dowhy.causal_model - INFO - propensity_score_weighting
2025-07-30 10:47:20,235 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Weighting Estimator
2025-07-30 10:47:20,236 - src.analytics.causal - WARNING - IPW estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 10:47:20,236 - dowhy.causal_model - INFO - linear_regression
2025-07-30 10:47:20,236 - dowhy.causal_estimator - INFO - INFO: Using Linear Regression Estimator
2025-07-30 10:47:20,236 - dowhy.causal_estimator - INFO - b: revenue~has_promotion+is_weekend
2025-07-30 10:47:20,241 - src.analytics.causal - WARNING - Placebo test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 10:47:20,241 - src.analytics.causal - WARNING - Random common cause test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 10:47:20,241 - src.engine.core - INFO - Step 5: Generating optimizations
2025-07-30 10:47:20,241 - src.analytics.optimization - INFO - Optimizing pricing strategy
2025-07-30 10:47:20,242 - src.engine.core - ERROR - Failed to generate pricing optimization: 'item_total_amt'
2025-07-30 10:47:20,242 - src.engine.core - INFO - Step 6: Generating AI insights
2025-07-30 10:47:20,693 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 10:47:25,954 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 10:47:25,962 - src.engine.core - ERROR - Failed to generate problem diagnosis: 1 validation error for SequentialChain
  Value error, Missing required input keys: {'format_instructions'}, only had {'decline_analysis', 'factors', 'historical_context', 'decline_pct', 'period'} [type=value_error, input_value={'chains': [LLMChain(verb...ions'], 'verbose': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
2025-07-30 10:47:37,819 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 10:47:37,822 - src.engine.core - INFO - Daily analysis completed in 18.32 seconds
2025-07-30 10:47:37,864 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 10:48:01,237 - src.data.mock_repository - INFO - Generating mock time series data for 90 days
2025-07-30 10:48:01,254 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 10:48:01,301 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/kgivn9kk.json
2025-07-30 10:48:01,304 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/4oc99b5r.json
2025-07-30 10:48:01,305 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:48:01,305 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:48:01,305 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=95748', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/kgivn9kk.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/4oc99b5r.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_model1qdr6h1m/prophet_model-20250730104801.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 10:48:01,305 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:48:01,550 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:48:01,573 - prophet - INFO - Making 3 forecasts with cutoffs between 2025-07-09 10:48:01.238238 and 2025-07-23 10:48:01.238238
2025-07-30 10:48:01,573 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 10:48:01,581 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/8cfjg3xm.json
2025-07-30 10:48:01,583 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/r_d5s3rs.json
2025-07-30 10:48:01,583 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:48:01,583 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:48:01,583 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=92521', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/8cfjg3xm.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/r_d5s3rs.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_model10qzp58n/prophet_model-20250730104801.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 10:48:01,583 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:48:01,689 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:48:01,714 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/0axa3a18.json
2025-07-30 10:48:01,716 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/jel1of3w.json
2025-07-30 10:48:01,716 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:48:01,716 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:48:01,716 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=99619', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/0axa3a18.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/jel1of3w.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_modelnoy0176s/prophet_model-20250730104801.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 10:48:01,716 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:48:01,857 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:48:01,882 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/yszj75zt.json
2025-07-30 10:48:01,884 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/bux7kfz9.json
2025-07-30 10:48:01,884 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:48:01,884 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:48:01,884 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=80979', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/yszj75zt.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/bux7kfz9.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp4kcp6mce/prophet_modelc1i12ml9/prophet_model-20250730104801.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 10:48:01,884 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:48:02,233 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:48:02,259 - src.analytics.predictive - INFO - Prophet CV MAPE: 14.32%
2025-07-30 10:48:02,259 - src.api.routes - ERROR - Prediction failed: 1 validation error for PredictionResponse
model_performance
  Field required [type=missing, input_value={'prediction_type': 'sale...844, 68953.7497438366]}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/api/routes.py", line 124, in create_prediction
    return PredictionResponse(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pydantic/main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for PredictionResponse
model_performance
  Field required [type=missing, input_value={'prediction_type': 'sale...844, 68953.7497438366]}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-07-30 10:48:33,892 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 10:48:33,904 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-30 10:49:53,123 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 10:50:19,509 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 10:50:22,793 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:50:23,380 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:50:23,380 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:50:23,380 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:50:23,380 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 10:50:23,994 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:50:24,530 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:50:24,531 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:50:24,531 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:50:24,531 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 10:50:24,998 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:50:26,340 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:50:26,342 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:50:26,343 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:50:26,343 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 10:50:26,343 - src.api.app - INFO - Engine initialized successfully
2025-07-30 10:50:26,357 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 10:50:26,357 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 10:50:26,358 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 10:50:26,358 - src.api.app - INFO - Scheduler started successfully
2025-07-30 10:50:37,594 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 10:51:26,364 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 10:51:29,532 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:51:30,146 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:51:30,146 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:51:30,146 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:51:30,146 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 10:51:30,599 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:51:31,167 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:51:31,167 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:51:31,168 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:51:31,168 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 10:51:32,752 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:51:33,445 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:51:33,445 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:51:33,445 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:51:33,446 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 10:51:33,446 - src.api.app - INFO - Engine initialized successfully
2025-07-30 10:51:33,457 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 10:51:33,457 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 10:51:33,458 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 10:51:33,458 - src.api.app - INFO - Scheduler started successfully
2025-07-30 10:51:33,466 - src.api.routes - INFO - Running new daily analysis
2025-07-30 10:51:33,467 - src.engine.core - INFO - Starting daily analysis
2025-07-30 10:51:33,467 - src.engine.core - INFO - Step 1: Collecting data
2025-07-30 10:51:33,467 - src.data.mock_repository - INFO - Generating mock daily sales data from 2025-05-01 10:51:33.467111 to 2025-07-30 10:51:33.467111
2025-07-30 10:51:33,469 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 10:51:33,470 - src.data.mock_repository - INFO - Generating mock customer segments data
2025-07-30 10:51:33,470 - src.data.mock_repository - INFO - Generating mock time series data for 180 days
2025-07-30 10:51:33,472 - src.data.mock_repository - INFO - Generating mock promotion effectiveness data for 30 days
2025-07-30 10:51:33,473 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-30 10:51:33,473 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-30 10:51:33,531 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-30 10:51:33,625 - src.engine.core - INFO - Step 3: Running predictions
2025-07-30 10:51:33,625 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 10:51:33,707 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/gg7gajdx.json
2025-07-30 10:51:33,711 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/aoa3s4ti.json
2025-07-30 10:51:33,711 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:51:33,711 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:51:33,711 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=39572', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/gg7gajdx.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/aoa3s4ti.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/prophet_modeljg4bcqt5/prophet_model-20250730105133.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:51:33,711 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:51:33,737 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:51:33,764 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-11 10:51:33.470640 and 2025-07-23 10:51:33.470640
2025-07-30 10:51:33,764 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 10:51:33,770 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/04m37t7x.json
2025-07-30 10:51:33,773 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/5llx_0fe.json
2025-07-30 10:51:33,774 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:51:33,774 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:51:33,774 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=58821', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/04m37t7x.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/5llx_0fe.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/prophet_modelen46199k/prophet_model-20250730105133.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:51:33,774 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:51:33,788 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:51:33,811 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/tt8ue_1u.json
2025-07-30 10:51:33,814 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/uqq_vhba.json
2025-07-30 10:51:33,814 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:51:33,814 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:51:33,814 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=52958', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/tt8ue_1u.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/uqq_vhba.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/prophet_modelnw6hek6u/prophet_model-20250730105133.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:51:33,814 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:51:33,829 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:51:33,853 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/2_xt4bzs.json
2025-07-30 10:51:33,856 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/48jf5183.json
2025-07-30 10:51:33,856 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:51:33,856 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:51:33,856 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=83564', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/2_xt4bzs.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/48jf5183.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/prophet_modelu9321uea/prophet_model-20250730105133.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:51:33,856 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:51:33,871 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:51:33,894 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/zr00dt14.json
2025-07-30 10:51:33,898 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/c2oseyva.json
2025-07-30 10:51:33,898 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:51:33,898 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:51:33,898 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=85036', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/zr00dt14.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/c2oseyva.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/prophet_modeldvtl1xsl/prophet_model-20250730105133.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:51:33,898 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:51:33,913 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:51:33,937 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/eqoj94uy.json
2025-07-30 10:51:33,940 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/rl21zspe.json
2025-07-30 10:51:33,940 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:51:33,940 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:51:33,940 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=32936', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/eqoj94uy.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/rl21zspe.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/prophet_modelmii1lz0x/prophet_model-20250730105133.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:51:33,940 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:51:33,957 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:51:33,981 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/i6rwx3e2.json
2025-07-30 10:51:33,984 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/3ul4dsl0.json
2025-07-30 10:51:33,984 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:51:33,984 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:51:33,984 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=29146', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/i6rwx3e2.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/3ul4dsl0.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/prophet_model5h3lvfkg/prophet_model-20250730105133.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:51:33,984 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:51:34,008 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:51:34,033 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/e76cmomi.json
2025-07-30 10:51:34,037 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/rahf2xg_.json
2025-07-30 10:51:34,037 - cmdstanpy - DEBUG - idx 0
2025-07-30 10:51:34,037 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 10:51:34,037 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=55599', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/e76cmomi.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/rahf2xg_.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp97hybth2/prophet_modelykb7jyad/prophet_model-20250730105134.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 10:51:34,037 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 10:51:34,054 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 10:51:34,079 - src.analytics.predictive - INFO - Prophet CV MAPE: 6.12%
2025-07-30 10:51:34,080 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-30 10:51:34,169 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-30 10:51:34,170 - src.analytics.causal - INFO - Analyzing causal effect of has_promotion on revenue
2025-07-30 10:51:34,186 - dowhy.causal_model - INFO - Model to find the causal effect of treatment ['has_promotion'] on outcome ['revenue']
2025-07-30 10:51:34,186 - dowhy.causal_model - WARNING - There are an additional 10 variables in the dataset that are not in the graph. Variable names are: '['avg_order_value', 'customer_count', 'date', 'hour_of_day', 'location_id', 'location_name', 'new_customer_count', 'order_count', 'repeat_customer_count', 'total_revenue']'
2025-07-30 10:51:34,186 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 10:51:34,188 - dowhy.causal_identifier.auto_identifier - INFO - Instrumental variables for treatment and outcome:[]
2025-07-30 10:51:34,188 - dowhy.causal_identifier.auto_identifier - INFO - Frontdoor variables for treatment and outcome:[]
2025-07-30 10:51:34,188 - dowhy.causal_identifier.auto_identifier - INFO - Number of general adjustment sets found: 1
2025-07-30 10:51:34,188 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 10:51:34,189 - dowhy.causal_model - INFO - propensity_score_matching
2025-07-30 10:51:34,189 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Matching Estimator
2025-07-30 10:51:34,190 - src.analytics.causal - WARNING - PSM estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 10:51:34,190 - dowhy.causal_model - INFO - propensity_score_weighting
2025-07-30 10:51:34,191 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Weighting Estimator
2025-07-30 10:51:34,191 - src.analytics.causal - WARNING - IPW estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 10:51:34,191 - dowhy.causal_model - INFO - linear_regression
2025-07-30 10:51:34,191 - dowhy.causal_estimator - INFO - INFO: Using Linear Regression Estimator
2025-07-30 10:51:34,192 - dowhy.causal_estimator - INFO - b: revenue~has_promotion+is_weekend
2025-07-30 10:51:34,196 - src.analytics.causal - WARNING - Placebo test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 10:51:34,196 - src.analytics.causal - WARNING - Random common cause test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 10:51:34,196 - src.engine.core - INFO - Step 5: Generating optimizations
2025-07-30 10:51:34,197 - src.analytics.optimization - INFO - Optimizing pricing strategy
2025-07-30 10:51:34,198 - src.engine.core - ERROR - Failed to generate pricing optimization: 'item_total_amt'
2025-07-30 10:51:34,198 - src.engine.core - INFO - Step 6: Generating AI insights
2025-07-30 10:51:34,670 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 10:51:39,700 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 10:51:39,711 - src.engine.core - ERROR - Failed to generate problem diagnosis: 1 validation error for SequentialChain
  Value error, Missing required input keys: {'format_instructions'}, only had {'period', 'factors', 'historical_context', 'decline_analysis', 'decline_pct'} [type=value_error, input_value={'chains': [LLMChain(verb...ions'], 'verbose': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
2025-07-30 10:51:47,558 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 10:51:47,561 - src.engine.core - INFO - Daily analysis completed in 14.09 seconds
2025-07-30 10:51:47,619 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 10:52:44,541 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 10:52:44,554 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-30 10:58:40,666 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 10:59:33,499 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 10:59:36,865 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:59:37,315 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:59:37,315 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:59:37,315 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:59:37,316 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 10:59:37,768 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:59:38,223 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:59:38,224 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:59:38,224 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:59:38,224 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 10:59:38,689 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 10:59:39,251 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 10:59:39,251 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:59:39,251 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 10:59:39,251 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 10:59:39,251 - src.api.app - INFO - Engine initialized successfully
2025-07-30 10:59:39,263 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 10:59:39,264 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 10:59:39,264 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 10:59:39,264 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:00:24,475 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 11:00:39,266 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 11:00:42,529 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:00:42,981 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:00:42,981 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:00:42,981 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:00:42,981 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 11:00:43,531 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:00:44,011 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:00:44,012 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:00:44,012 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:00:44,012 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 11:00:44,554 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:00:45,005 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:00:45,005 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:00:45,005 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:00:45,005 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 11:00:45,005 - src.api.app - INFO - Engine initialized successfully
2025-07-30 11:00:45,014 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 11:00:45,014 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 11:00:45,015 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 11:00:45,015 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:01:20,329 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 11:01:45,020 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 11:01:48,044 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:01:48,657 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:01:48,658 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:01:48,658 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:01:48,658 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 11:01:49,168 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:01:49,681 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:01:49,681 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:01:49,681 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:01:49,681 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 11:01:50,294 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:01:50,798 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:01:50,798 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:01:50,798 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:01:50,799 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 11:01:50,799 - src.api.app - INFO - Engine initialized successfully
2025-07-30 11:01:50,808 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 11:01:50,808 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 11:01:50,809 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 11:01:50,809 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:01:50,818 - src.api.routes - INFO - Running new daily analysis
2025-07-30 11:01:50,818 - src.engine.core - INFO - Starting daily analysis
2025-07-30 11:01:50,818 - src.engine.core - INFO - Step 1: Collecting data
2025-07-30 11:01:50,818 - src.data.mock_repository - INFO - Generating mock daily sales data from 2025-05-01 11:01:50.818559 to 2025-07-30 11:01:50.818559
2025-07-30 11:01:50,820 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 11:01:50,821 - src.data.mock_repository - INFO - Generating mock customer segments data
2025-07-30 11:01:50,822 - src.data.mock_repository - INFO - Generating mock time series data for 180 days
2025-07-30 11:01:50,823 - src.data.mock_repository - INFO - Generating mock promotion effectiveness data for 30 days
2025-07-30 11:01:50,824 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-30 11:01:50,824 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-30 11:01:50,907 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-30 11:01:50,999 - src.engine.core - INFO - Step 3: Running predictions
2025-07-30 11:01:50,999 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 11:01:51,079 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/uniaz09z.json
2025-07-30 11:01:51,083 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/5ev9erv5.json
2025-07-30 11:01:51,083 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:01:51,083 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:01:51,083 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=70786', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/uniaz09z.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/5ev9erv5.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_modelqzcuwv9z/prophet_model-20250730110151.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:01:51,083 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:01:51,106 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:01:51,134 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-11 11:01:50.822171 and 2025-07-23 11:01:50.822171
2025-07-30 11:01:51,134 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 11:01:51,142 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/3s60pk94.json
2025-07-30 11:01:51,144 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/bx8m0wye.json
2025-07-30 11:01:51,145 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:01:51,145 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:01:51,145 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=23859', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/3s60pk94.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/bx8m0wye.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_modeljqmst6dh/prophet_model-20250730110151.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:01:51,145 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:01:51,159 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:01:51,183 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/ex0mw91r.json
2025-07-30 11:01:51,186 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/bht5fbhp.json
2025-07-30 11:01:51,186 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:01:51,186 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:01:51,186 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=68829', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/ex0mw91r.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/bht5fbhp.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_modelqhravqi8/prophet_model-20250730110151.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:01:51,186 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:01:51,200 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:01:51,224 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/s_4_nkxj.json
2025-07-30 11:01:51,227 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/rnqu0zt1.json
2025-07-30 11:01:51,227 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:01:51,227 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:01:51,227 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=39681', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/s_4_nkxj.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/rnqu0zt1.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_modellxvfxkz9/prophet_model-20250730110151.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:01:51,227 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:01:51,246 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:01:51,270 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/ebaoficl.json
2025-07-30 11:01:51,274 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/e0b8br0u.json
2025-07-30 11:01:51,274 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:01:51,274 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:01:51,274 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=26575', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/ebaoficl.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/e0b8br0u.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_modeloaea12qq/prophet_model-20250730110151.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:01:51,274 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:01:51,288 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:01:51,311 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/2vecd1fw.json
2025-07-30 11:01:51,315 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/fkoce_5x.json
2025-07-30 11:01:51,315 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:01:51,315 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:01:51,315 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=39580', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/2vecd1fw.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/fkoce_5x.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_model6w9btx9d/prophet_model-20250730110151.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:01:51,315 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:01:51,330 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:01:51,354 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/tczupiym.json
2025-07-30 11:01:51,357 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/g4f50bz6.json
2025-07-30 11:01:51,358 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:01:51,358 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:01:51,358 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=31277', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/tczupiym.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/g4f50bz6.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_modelvl6297jc/prophet_model-20250730110151.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:01:51,358 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:01:51,372 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:01:51,396 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/f7s19zw6.json
2025-07-30 11:01:51,400 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/w7bkbas8.json
2025-07-30 11:01:51,400 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:01:51,400 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:01:51,400 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=66578', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/f7s19zw6.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/w7bkbas8.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_modelhhuvkkok/prophet_model-20250730110151.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:01:51,400 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:01:51,414 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:01:51,441 - src.analytics.predictive - INFO - Prophet CV MAPE: 4.62%
2025-07-30 11:01:51,441 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-30 11:01:51,527 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-30 11:01:51,528 - src.analytics.causal - INFO - Analyzing causal effect of has_promotion on revenue
2025-07-30 11:01:51,540 - dowhy.causal_model - INFO - Model to find the causal effect of treatment ['has_promotion'] on outcome ['revenue']
2025-07-30 11:01:51,540 - dowhy.causal_model - WARNING - There are an additional 10 variables in the dataset that are not in the graph. Variable names are: '['avg_order_value', 'customer_count', 'date', 'hour_of_day', 'location_id', 'location_name', 'new_customer_count', 'order_count', 'repeat_customer_count', 'total_revenue']'
2025-07-30 11:01:51,541 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 11:01:51,542 - dowhy.causal_identifier.auto_identifier - INFO - Instrumental variables for treatment and outcome:[]
2025-07-30 11:01:51,542 - dowhy.causal_identifier.auto_identifier - INFO - Frontdoor variables for treatment and outcome:[]
2025-07-30 11:01:51,543 - dowhy.causal_identifier.auto_identifier - INFO - Number of general adjustment sets found: 1
2025-07-30 11:01:51,543 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 11:01:51,543 - dowhy.causal_model - INFO - propensity_score_matching
2025-07-30 11:01:51,543 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Matching Estimator
2025-07-30 11:01:51,544 - src.analytics.causal - WARNING - PSM estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 11:01:51,544 - dowhy.causal_model - INFO - propensity_score_weighting
2025-07-30 11:01:51,545 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Weighting Estimator
2025-07-30 11:01:51,545 - src.analytics.causal - WARNING - IPW estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 11:01:51,545 - dowhy.causal_model - INFO - linear_regression
2025-07-30 11:01:51,545 - dowhy.causal_estimator - INFO - INFO: Using Linear Regression Estimator
2025-07-30 11:01:51,545 - dowhy.causal_estimator - INFO - b: revenue~has_promotion+is_weekend
2025-07-30 11:01:51,549 - src.analytics.causal - WARNING - Placebo test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 11:01:51,549 - src.analytics.causal - WARNING - Random common cause test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 11:01:51,549 - src.engine.core - INFO - Step 5: Generating optimizations
2025-07-30 11:01:51,550 - src.analytics.optimization - INFO - Optimizing pricing strategy
2025-07-30 11:01:51,551 - src.engine.core - ERROR - Failed to generate pricing optimization: 'item_total_amt'
2025-07-30 11:01:51,551 - src.engine.core - INFO - Step 6: Generating AI insights
2025-07-30 11:01:52,015 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 11:01:55,786 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:01:55,797 - src.engine.core - ERROR - Failed to generate problem diagnosis: 1 validation error for SequentialChain
  Value error, Missing required input keys: {'format_instructions'}, only had {'period', 'decline_pct', 'historical_context', 'factors', 'decline_analysis'} [type=value_error, input_value={'chains': [LLMChain(verb...ions'], 'verbose': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
2025-07-30 11:02:02,278 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:02:02,281 - src.engine.core - INFO - Daily analysis completed in 11.46 seconds
2025-07-30 11:02:02,373 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 11:02:02,381 - src.data.mock_repository - INFO - Generating mock customer segments data
2025-07-30 11:02:14,189 - src.data.mock_repository - INFO - Generating mock time series data for 90 days
2025-07-30 11:02:14,191 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 11:02:14,234 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/1z4jezqm.json
2025-07-30 11:02:14,237 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/qfk0l4c4.json
2025-07-30 11:02:14,237 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:02:14,237 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:02:14,237 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=61531', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/1z4jezqm.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/qfk0l4c4.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_modelramulqwb/prophet_model-20250730110214.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:02:14,237 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:02:14,710 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:02:14,735 - prophet - INFO - Making 3 forecasts with cutoffs between 2025-07-09 11:02:14.189580 and 2025-07-23 11:02:14.189580
2025-07-30 11:02:14,735 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 11:02:14,741 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/ey66qa7w.json
2025-07-30 11:02:14,743 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/_zm113zt.json
2025-07-30 11:02:14,744 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:02:14,744 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:02:14,744 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=70705', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/ey66qa7w.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/_zm113zt.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_model9wgl601i/prophet_model-20250730110214.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:02:14,744 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:02:26,122 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:02:26,159 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/zvlrtnrz.json
2025-07-30 11:02:26,161 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/r21fa6c5.json
2025-07-30 11:02:26,162 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:02:26,162 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:02:26,162 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=42658', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/zvlrtnrz.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/r21fa6c5.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_modell_fajwhb/prophet_model-20250730110226.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:02:26,162 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:02:26,261 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:02:26,284 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/3bsznn_i.json
2025-07-30 11:02:26,286 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/_q8ecqlk.json
2025-07-30 11:02:26,287 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:02:26,287 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:02:26,287 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=9807', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/3bsznn_i.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/_q8ecqlk.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpddlotluy/prophet_modelwpza0ox6/prophet_model-20250730110226.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:02:26,287 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:02:26,414 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:02:26,441 - src.analytics.predictive - INFO - Prophet CV MAPE: 29.78%
2025-07-30 11:02:26,442 - src.api.routes - ERROR - Prediction failed: 1 validation error for PredictionResponse
model_performance
  Field required [type=missing, input_value={'prediction_type': 'sale...46, 66406.68678308974]}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/api/routes.py", line 124, in create_prediction
    return PredictionResponse(
           ^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/pydantic/main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for PredictionResponse
model_performance
  Field required [type=missing, input_value={'prediction_type': 'sale...46, 66406.68678308974]}}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-07-30 11:02:57,668 - src.llm.agents - ERROR - Failed to create agent: 'AzureOpenAIClient' object has no attribute 'client'
2025-07-30 11:02:57,668 - src.engine.core - WARNING - Failed to initialize AI agent: 'AzureOpenAIClient' object has no attribute 'client'
2025-07-30 11:08:22,375 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 11:08:50,780 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 11:08:54,089 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:08:54,555 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:08:54,555 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:08:54,556 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:08:54,556 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 11:08:55,115 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:08:55,573 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:08:55,573 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:08:55,573 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:08:55,574 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 11:08:56,033 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:08:56,546 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:08:56,547 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:08:56,547 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:08:56,547 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 11:08:56,547 - src.api.app - INFO - Engine initialized successfully
2025-07-30 11:08:56,556 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 11:08:56,556 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 11:08:56,556 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 11:08:56,557 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:08:56,567 - src.data.mock_repository - INFO - Generating mock time series data for 90 days
2025-07-30 11:08:56,570 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 11:08:56,657 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/4x4e3vbc.json
2025-07-30 11:08:56,660 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/xj_28wy2.json
2025-07-30 11:08:56,660 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:08:56,660 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:08:56,660 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=41730', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/4x4e3vbc.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/xj_28wy2.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_modelg_2dn7h6/prophet_model-20250730110856.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:08:56,660 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:08:56,828 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:08:56,851 - prophet - INFO - Making 3 forecasts with cutoffs between 2025-07-09 11:08:56.568011 and 2025-07-23 11:08:56.568011
2025-07-30 11:08:56,851 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 11:08:56,859 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/7zuodd6k.json
2025-07-30 11:08:56,860 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/s9wsydp6.json
2025-07-30 11:08:56,861 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:08:56,861 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:08:56,861 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=2411', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/7zuodd6k.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/s9wsydp6.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_modelxzf5pn_u/prophet_model-20250730110856.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:08:56,861 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:08:57,138 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:08:57,188 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/9zfkinwv.json
2025-07-30 11:08:57,191 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/d6qubxja.json
2025-07-30 11:08:57,191 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:08:57,191 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:08:57,191 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=79677', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/9zfkinwv.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/d6qubxja.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_modelmdj06yxp/prophet_model-20250730110857.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:08:57,191 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:08:57,364 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:08:57,392 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/pp8fzd8w.json
2025-07-30 11:08:57,394 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/8k2svsmd.json
2025-07-30 11:08:57,395 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:08:57,395 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:08:57,395 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=55037', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/pp8fzd8w.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/8k2svsmd.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_modeln2claa2u/prophet_model-20250730110857.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:08:57,395 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:08:57,588 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:08:57,618 - src.analytics.predictive - INFO - Prophet CV MAPE: 18.03%
2025-07-30 11:09:15,537 - src.llm.agents - ERROR - Failed to create agent: 'AzureOpenAIClient' object has no attribute 'client'
2025-07-30 11:09:15,537 - src.engine.core - WARNING - Failed to initialize AI agent: 'AzureOpenAIClient' object has no attribute 'client'
2025-07-30 11:09:40,427 - src.api.routes - INFO - No cached recommendations, running analysis
2025-07-30 11:09:40,427 - src.engine.core - INFO - Starting daily analysis
2025-07-30 11:09:40,427 - src.engine.core - INFO - Step 1: Collecting data
2025-07-30 11:09:40,427 - src.data.mock_repository - INFO - Generating mock daily sales data from 2025-05-01 11:09:40.427666 to 2025-07-30 11:09:40.427666
2025-07-30 11:09:40,429 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 11:09:40,430 - src.data.mock_repository - INFO - Generating mock customer segments data
2025-07-30 11:09:40,431 - src.data.mock_repository - INFO - Generating mock time series data for 180 days
2025-07-30 11:09:40,432 - src.data.mock_repository - INFO - Generating mock promotion effectiveness data for 30 days
2025-07-30 11:09:40,432 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-30 11:09:40,433 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-30 11:09:40,497 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-30 11:09:40,590 - src.engine.core - INFO - Step 3: Running predictions
2025-07-30 11:09:40,590 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 11:09:40,620 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/fpioxhjw.json
2025-07-30 11:09:40,624 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/5iema09d.json
2025-07-30 11:09:40,624 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:09:40,624 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:09:40,624 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=85357', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/fpioxhjw.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/5iema09d.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_modelp4bukfwy/prophet_model-20250730110940.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:09:40,624 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:09:40,649 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:09:40,676 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-11 11:09:40.431071 and 2025-07-23 11:09:40.431071
2025-07-30 11:09:40,677 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 11:09:40,683 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/vyrsa8nb.json
2025-07-30 11:09:40,686 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/jioyn08f.json
2025-07-30 11:09:40,686 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:09:40,686 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:09:40,686 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=77250', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/vyrsa8nb.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/jioyn08f.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_modeln8e6y7zc/prophet_model-20250730110940.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:09:40,686 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:09:40,702 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:09:40,725 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/47qt1mk7.json
2025-07-30 11:09:40,728 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/heczobut.json
2025-07-30 11:09:40,729 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:09:40,729 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:09:40,729 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=8902', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/47qt1mk7.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/heczobut.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_model2_wm4k56/prophet_model-20250730110940.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:09:40,729 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:09:40,742 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:09:40,765 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/9fqwlikh.json
2025-07-30 11:09:40,769 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/3jpbzv8x.json
2025-07-30 11:09:40,769 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:09:40,769 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:09:40,769 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=26432', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/9fqwlikh.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/3jpbzv8x.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_model85gdx_t_/prophet_model-20250730110940.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:09:40,769 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:09:40,790 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:09:40,817 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/yowupzmu.json
2025-07-30 11:09:40,820 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/705gw5tc.json
2025-07-30 11:09:40,820 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:09:40,820 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:09:40,820 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=66090', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/yowupzmu.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/705gw5tc.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_modelb7a8_gb0/prophet_model-20250730110940.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:09:40,820 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:09:40,837 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:09:40,860 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/cvufb7d1.json
2025-07-30 11:09:40,864 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/z0wkof_l.json
2025-07-30 11:09:40,864 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:09:40,864 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:09:40,864 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=37627', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/cvufb7d1.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/z0wkof_l.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_modelowmzt258/prophet_model-20250730110940.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:09:40,864 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:09:40,880 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:09:40,904 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/tlpmhr12.json
2025-07-30 11:09:40,908 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/xzq7jb5d.json
2025-07-30 11:09:40,908 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:09:40,908 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:09:40,908 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=54965', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/tlpmhr12.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/xzq7jb5d.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_model0yfsg9n4/prophet_model-20250730110940.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:09:40,908 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:09:40,923 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:09:40,948 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/hb1au1y2.json
2025-07-30 11:09:40,951 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/fd36n4la.json
2025-07-30 11:09:40,952 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:09:40,952 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:09:40,952 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=89204', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/hb1au1y2.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/fd36n4la.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmptqx9ewmy/prophet_modelc4ob6bij/prophet_model-20250730110940.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:09:40,952 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:09:40,968 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:09:40,994 - src.analytics.predictive - INFO - Prophet CV MAPE: 4.30%
2025-07-30 11:09:40,994 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-30 11:09:41,079 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-30 11:09:41,080 - src.analytics.causal - INFO - Analyzing causal effect of has_promotion on revenue
2025-07-30 11:09:41,094 - dowhy.causal_model - INFO - Model to find the causal effect of treatment ['has_promotion'] on outcome ['revenue']
2025-07-30 11:09:41,094 - dowhy.causal_model - WARNING - There are an additional 10 variables in the dataset that are not in the graph. Variable names are: '['avg_order_value', 'customer_count', 'date', 'hour_of_day', 'location_id', 'location_name', 'new_customer_count', 'order_count', 'repeat_customer_count', 'total_revenue']'
2025-07-30 11:09:41,095 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 11:09:41,096 - dowhy.causal_identifier.auto_identifier - INFO - Instrumental variables for treatment and outcome:[]
2025-07-30 11:09:41,096 - dowhy.causal_identifier.auto_identifier - INFO - Frontdoor variables for treatment and outcome:[]
2025-07-30 11:09:41,096 - dowhy.causal_identifier.auto_identifier - INFO - Number of general adjustment sets found: 1
2025-07-30 11:09:41,096 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 11:09:41,097 - dowhy.causal_model - INFO - propensity_score_matching
2025-07-30 11:09:41,097 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Matching Estimator
2025-07-30 11:09:41,098 - src.analytics.causal - WARNING - PSM estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 11:09:41,098 - dowhy.causal_model - INFO - propensity_score_weighting
2025-07-30 11:09:41,098 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Weighting Estimator
2025-07-30 11:09:41,099 - src.analytics.causal - WARNING - IPW estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 11:09:41,099 - dowhy.causal_model - INFO - linear_regression
2025-07-30 11:09:41,099 - dowhy.causal_estimator - INFO - INFO: Using Linear Regression Estimator
2025-07-30 11:09:41,099 - dowhy.causal_estimator - INFO - b: revenue~has_promotion+is_weekend
2025-07-30 11:09:41,104 - src.analytics.causal - WARNING - Placebo test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 11:09:41,104 - src.analytics.causal - WARNING - Random common cause test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 11:09:41,104 - src.engine.core - INFO - Step 5: Generating optimizations
2025-07-30 11:09:41,104 - src.analytics.optimization - INFO - Optimizing pricing strategy
2025-07-30 11:09:41,105 - src.engine.core - ERROR - Failed to generate pricing optimization: 'item_total_amt'
2025-07-30 11:09:41,106 - src.engine.core - INFO - Step 6: Generating AI insights
2025-07-30 11:09:41,303 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 11:09:45,446 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:09:45,452 - src.engine.core - ERROR - Failed to generate problem diagnosis: 1 validation error for SequentialChain
  Value error, Missing required input keys: {'format_instructions'}, only had {'period', 'decline_pct', 'historical_context', 'decline_analysis', 'factors'} [type=value_error, input_value={'chains': [LLMChain(verb...ions'], 'verbose': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
2025-07-30 11:09:54,097 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:09:54,119 - src.engine.core - INFO - Daily analysis completed in 13.69 seconds
2025-07-30 11:14:06,043 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 11:14:06,070 - src.data.mock_repository - INFO - Generating mock customer segments data
2025-07-30 11:15:35,988 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 11:15:56,584 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 11:16:00,079 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:16:00,535 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:16:00,536 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:16:00,536 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:16:00,536 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 11:16:00,996 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:16:01,513 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:16:01,514 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:16:01,514 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:16:01,514 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 11:16:02,023 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:16:02,566 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:16:02,566 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:16:02,566 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:16:02,566 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 11:16:02,566 - src.api.app - INFO - Engine initialized successfully
2025-07-30 11:16:02,578 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 11:16:02,579 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 11:16:02,579 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 11:16:02,579 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:16:03,035 - src.llm.agents - ERROR - Failed to create agent: 'AzureOpenAIClient' object has no attribute 'client'
2025-07-30 11:16:03,035 - src.api.routes - ERROR - Insight generation failed: 'AzureOpenAIClient' object has no attribute 'client'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/api/routes.py", line 191, in generate_insights
    response = engine.ai_agent.chat(request.query)
               ^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/engine/core.py", line 63, in ai_agent
    self._ai_agent = AIGrowthAgent()
                     ^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/llm/agents.py", line 52, in __init__
    self.agent = self._create_agent()
                 ^^^^^^^^^^^^^^^^^^^^
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/llm/agents.py", line 120, in _create_agent
    llm=self.llm_client.client,
        ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'AzureOpenAIClient' object has no attribute 'client'
2025-07-30 11:19:52,280 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 11:20:02,592 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 11:20:07,271 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:20:07,773 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:20:07,774 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:20:07,774 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:20:07,774 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 11:20:08,234 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:20:12,083 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:20:12,083 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:20:12,083 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:20:12,083 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 11:20:12,700 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:20:15,259 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:20:15,260 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:20:15,260 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:20:15,261 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 11:20:15,261 - src.api.app - INFO - Engine initialized successfully
2025-07-30 11:20:15,278 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 11:20:15,278 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 11:20:15,278 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 11:20:15,278 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:20:18,639 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 11:20:18,645 - src.llm.agents - INFO - Agent chat query: hello
2025-07-30 11:20:18,649 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-30 11:20:44,245 - src.llm.agents - INFO - Agent chat query: hello
2025-07-30 11:20:44,253 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-30 11:20:51,093 - src.llm.agents - INFO - Agent chat query: hell0
2025-07-30 11:20:51,096 - src.llm.agents - ERROR - Agent chat failed: "Input to ChatPromptTemplate is missing variables {'tools'}.  Expected: ['agent_scratchpad', 'chat_history', 'input', 'tools'] Received: ['input', 'chat_history', 'intermediate_steps', 'agent_scratchpad']\nNote: if you intended {tools} to be part of the string and not a variable, please escape it with double curly braces like: '{{tools}}'.\nFor troubleshooting, visit: https://python.langchain.com/docs/troubleshooting/errors/INVALID_PROMPT_INPUT "
2025-07-30 11:21:40,175 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 11:22:15,264 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 11:22:18,728 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:22:19,198 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:22:19,198 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:22:19,198 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:22:19,198 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 11:22:19,750 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:22:20,200 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:22:20,200 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:22:20,200 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:22:20,200 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 11:22:20,645 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:22:21,092 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:22:21,092 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:22:21,092 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:22:21,092 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 11:22:21,092 - src.api.app - INFO - Engine initialized successfully
2025-07-30 11:22:21,096 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 11:22:21,096 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 11:22:21,096 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 11:22:21,096 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:22:21,735 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 11:22:21,741 - src.llm.agents - INFO - Agent chat query: hello
2025-07-30 11:22:23,642 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:22:33,073 - src.api.routes - INFO - No cached recommendations, running analysis
2025-07-30 11:22:33,074 - src.engine.core - INFO - Starting daily analysis
2025-07-30 11:22:33,074 - src.engine.core - INFO - Step 1: Collecting data
2025-07-30 11:22:33,074 - src.data.mock_repository - INFO - Generating mock daily sales data from 2025-05-01 11:22:33.074430 to 2025-07-30 11:22:33.074430
2025-07-30 11:22:33,081 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 11:22:33,083 - src.data.mock_repository - INFO - Generating mock customer segments data
2025-07-30 11:22:33,084 - src.data.mock_repository - INFO - Generating mock time series data for 180 days
2025-07-30 11:22:33,087 - src.data.mock_repository - INFO - Generating mock promotion effectiveness data for 30 days
2025-07-30 11:22:33,088 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-30 11:22:33,088 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-30 11:22:33,162 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-30 11:22:33,264 - src.engine.core - INFO - Step 3: Running predictions
2025-07-30 11:22:33,264 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 11:22:33,351 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/bf67tcjn.json
2025-07-30 11:22:33,355 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/oan0rs40.json
2025-07-30 11:22:33,355 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:22:33,355 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:22:33,355 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=77485', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/bf67tcjn.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/oan0rs40.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_model_5w968vh/prophet_model-20250730112233.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:22:33,355 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:22:33,383 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:22:33,411 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-11 11:22:33.084386 and 2025-07-23 11:22:33.084386
2025-07-30 11:22:33,412 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 11:22:33,419 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/w3csnq_n.json
2025-07-30 11:22:33,422 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/badbmnh6.json
2025-07-30 11:22:33,422 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:22:33,422 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:22:33,422 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=67875', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/w3csnq_n.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/badbmnh6.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_modelhrlainzq/prophet_model-20250730112233.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:22:33,422 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:22:33,436 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:22:33,461 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/fhdwzo1f.json
2025-07-30 11:22:33,463 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/kw6baq7v.json
2025-07-30 11:22:33,464 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:22:33,464 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:22:33,464 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=57365', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/fhdwzo1f.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/kw6baq7v.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_modelbmjwcsch/prophet_model-20250730112233.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:22:33,464 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:22:33,480 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:22:33,503 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/qdhxpl8a.json
2025-07-30 11:22:33,506 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/jwst6spw.json
2025-07-30 11:22:33,507 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:22:33,507 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:22:33,507 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=80683', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/qdhxpl8a.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/jwst6spw.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_modeleu4ay5rn/prophet_model-20250730112233.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:22:33,507 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:22:33,522 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:22:33,547 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/oythnvpd.json
2025-07-30 11:22:33,550 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/q3q012ce.json
2025-07-30 11:22:33,551 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:22:33,551 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:22:33,551 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=60810', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/oythnvpd.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/q3q012ce.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_model1v4bh7_x/prophet_model-20250730112233.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:22:33,551 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:22:33,567 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:22:33,592 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/67k9s9tj.json
2025-07-30 11:22:33,596 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/k0ermjns.json
2025-07-30 11:22:33,596 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:22:33,596 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:22:33,596 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=56685', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/67k9s9tj.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/k0ermjns.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_modelxzxycnqt/prophet_model-20250730112233.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:22:33,596 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:22:33,612 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:22:33,638 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/h9sqrhlo.json
2025-07-30 11:22:33,642 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/4er1j_cy.json
2025-07-30 11:22:33,642 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:22:33,642 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:22:33,642 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=55177', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/h9sqrhlo.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/4er1j_cy.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_modelc4rmhx08/prophet_model-20250730112233.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:22:33,642 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:22:33,656 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:22:33,680 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/8e_m4rci.json
2025-07-30 11:22:33,684 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/l1ea9g8_.json
2025-07-30 11:22:33,684 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:22:33,684 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:22:33,684 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=48846', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/8e_m4rci.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/l1ea9g8_.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_modelk4dttbcf/prophet_model-20250730112233.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:22:33,684 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:22:33,699 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:22:33,725 - src.analytics.predictive - INFO - Prophet CV MAPE: 4.49%
2025-07-30 11:22:33,725 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-30 11:22:33,811 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-30 11:22:33,812 - src.analytics.causal - INFO - Analyzing causal effect of has_promotion on revenue
2025-07-30 11:22:33,827 - dowhy.causal_model - INFO - Model to find the causal effect of treatment ['has_promotion'] on outcome ['revenue']
2025-07-30 11:22:33,827 - dowhy.causal_model - WARNING - There are an additional 10 variables in the dataset that are not in the graph. Variable names are: '['avg_order_value', 'customer_count', 'date', 'hour_of_day', 'location_id', 'location_name', 'new_customer_count', 'order_count', 'repeat_customer_count', 'total_revenue']'
2025-07-30 11:22:33,828 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 11:22:33,830 - dowhy.causal_identifier.auto_identifier - INFO - Instrumental variables for treatment and outcome:[]
2025-07-30 11:22:33,830 - dowhy.causal_identifier.auto_identifier - INFO - Frontdoor variables for treatment and outcome:[]
2025-07-30 11:22:33,831 - dowhy.causal_identifier.auto_identifier - INFO - Number of general adjustment sets found: 1
2025-07-30 11:22:33,831 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 11:22:33,831 - dowhy.causal_model - INFO - propensity_score_matching
2025-07-30 11:22:33,832 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Matching Estimator
2025-07-30 11:22:33,834 - src.analytics.causal - WARNING - PSM estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 11:22:33,834 - dowhy.causal_model - INFO - propensity_score_weighting
2025-07-30 11:22:33,834 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Weighting Estimator
2025-07-30 11:22:33,835 - src.analytics.causal - WARNING - IPW estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 11:22:33,835 - dowhy.causal_model - INFO - linear_regression
2025-07-30 11:22:33,835 - dowhy.causal_estimator - INFO - INFO: Using Linear Regression Estimator
2025-07-30 11:22:33,835 - dowhy.causal_estimator - INFO - b: revenue~has_promotion+is_weekend
2025-07-30 11:22:33,844 - src.analytics.causal - WARNING - Placebo test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 11:22:33,844 - src.analytics.causal - WARNING - Random common cause test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 11:22:33,844 - src.engine.core - INFO - Step 5: Generating optimizations
2025-07-30 11:22:33,844 - src.analytics.optimization - INFO - Optimizing pricing strategy
2025-07-30 11:22:33,846 - src.engine.core - ERROR - Failed to generate pricing optimization: 'item_total_amt'
2025-07-30 11:22:33,846 - src.engine.core - INFO - Step 6: Generating AI insights
2025-07-30 11:22:33,862 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 11:22:38,009 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:22:38,020 - src.engine.core - ERROR - Failed to generate problem diagnosis: 1 validation error for SequentialChain
  Value error, Missing required input keys: {'format_instructions'}, only had {'period', 'decline_analysis', 'decline_pct', 'historical_context', 'factors'} [type=value_error, input_value={'chains': [LLMChain(verb...ions'], 'verbose': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
2025-07-30 11:22:44,464 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:22:44,468 - src.engine.core - INFO - Daily analysis completed in 11.39 seconds
2025-07-30 11:22:56,772 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 11:22:58,313 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:22:58,865 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:22:59,402 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:22:59,402 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:22:59,402 - src.data.connectors - ERROR - Failed to convert to DataFrame: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:23:00,194 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:23:15,060 - src.llm.agents - INFO - Agent chat query: 哪些商品需要补货？
2025-07-30 11:23:17,299 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:23:17,370 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:23:18,402 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:23:22,175 - src.llm.agents - INFO - Agent chat query: 明天需要注意什么？
2025-07-30 11:23:23,237 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:23:23,250 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:23:23,252 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:23:23,712 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:23:24,260 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:23:24,261 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:23:24,261 - src.data.connectors - ERROR - Failed to convert to DataFrame: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:23:25,215 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:23:30,935 - src.llm.agents - INFO - Agent chat query: 哪些商品需要补货？
2025-07-30 11:23:31,886 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:23:31,938 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:23:32,786 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:23:37,619 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 11:23:39,006 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:23:39,044 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:23:39,982 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:23:47,703 - src.data.mock_repository - INFO - Generating mock time series data for 90 days
2025-07-30 11:23:47,708 - src.analytics.predictive - INFO - Starting Prophet prediction for 6 periods
2025-07-30 11:23:47,752 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/btsq3rgk.json
2025-07-30 11:23:47,756 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/nntvwmm4.json
2025-07-30 11:23:47,756 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:23:47,756 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:23:47,756 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=21275', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/btsq3rgk.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/nntvwmm4.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_modelqx63boy1/prophet_model-20250730112347.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:23:47,756 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:23:47,878 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:23:47,900 - prophet - INFO - Making 3 forecasts with cutoffs between 2025-07-09 11:23:47.704258 and 2025-07-23 11:23:47.704258
2025-07-30 11:23:47,900 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 11:23:47,908 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/u244xple.json
2025-07-30 11:23:47,910 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/rtenq5f7.json
2025-07-30 11:23:47,910 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:23:47,910 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:23:47,910 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=73113', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/u244xple.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/rtenq5f7.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_model0o5cnked/prophet_model-20250730112347.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:23:47,910 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:23:47,988 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:23:48,010 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/wa4kkpiq.json
2025-07-30 11:23:48,012 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/7ssf0_zm.json
2025-07-30 11:23:48,013 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:23:48,013 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:23:48,013 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=63597', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/wa4kkpiq.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/7ssf0_zm.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_model2pmue__i/prophet_model-20250730112348.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:23:48,013 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:23:48,198 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:23:48,221 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/p2597qpt.json
2025-07-30 11:23:48,223 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/3ocb0k74.json
2025-07-30 11:23:48,223 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:23:48,224 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:23:48,224 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=11662', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/p2597qpt.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/3ocb0k74.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpzfkmynjz/prophet_modelnryhjijm/prophet_model-20250730112348.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:23:48,224 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:23:48,440 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:23:48,465 - src.analytics.predictive - INFO - Prophet CV MAPE: 24.45%
2025-07-30 11:24:43,580 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 11:25:21,106 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 11:25:24,172 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:25:24,637 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:25:24,638 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:25:24,638 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:25:24,638 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 11:25:25,087 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:25:25,543 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:25:25,543 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:25:25,543 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:25:25,543 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 11:25:26,016 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:25:26,465 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:25:26,465 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:25:26,465 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:25:26,465 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 11:25:26,466 - src.api.app - INFO - Engine initialized successfully
2025-07-30 11:25:26,472 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 11:25:26,473 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 11:25:26,473 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 11:25:26,473 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:25:26,483 - src.api.routes - INFO - Running new daily analysis
2025-07-30 11:25:26,483 - src.engine.core - INFO - Starting daily analysis
2025-07-30 11:25:26,483 - src.engine.core - INFO - Step 1: Collecting data
2025-07-30 11:25:26,483 - src.data.mock_repository - INFO - Generating mock daily sales data from 2025-05-01 11:25:26.483885 to 2025-07-30 11:25:26.483885
2025-07-30 11:25:26,486 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 11:25:26,487 - src.data.mock_repository - INFO - Generating mock customer segments data
2025-07-30 11:25:26,487 - src.data.mock_repository - INFO - Generating mock time series data for 180 days
2025-07-30 11:25:26,489 - src.data.mock_repository - INFO - Generating mock promotion effectiveness data for 30 days
2025-07-30 11:25:26,490 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-30 11:25:26,490 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-30 11:25:26,551 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-30 11:25:26,644 - src.engine.core - INFO - Step 3: Running predictions
2025-07-30 11:25:26,644 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 11:25:26,720 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/y62a51zl.json
2025-07-30 11:25:26,724 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/7r37ja7i.json
2025-07-30 11:25:26,724 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:25:26,724 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:25:26,724 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=51726', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/y62a51zl.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/7r37ja7i.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_modelj7qzx97d/prophet_model-20250730112526.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:25:26,724 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:25:26,745 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:25:26,773 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-11 11:25:26.487957 and 2025-07-23 11:25:26.487957
2025-07-30 11:25:26,773 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 11:25:26,781 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/v5aj_bxi.json
2025-07-30 11:25:26,784 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/qano840w.json
2025-07-30 11:25:26,784 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:25:26,784 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:25:26,784 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=18552', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/v5aj_bxi.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/qano840w.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_modelc2lztkth/prophet_model-20250730112526.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:25:26,784 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:25:26,798 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:25:26,822 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/2zqwt6z4.json
2025-07-30 11:25:26,824 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/sfqu1lgr.json
2025-07-30 11:25:26,825 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:25:26,825 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:25:26,825 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=68840', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/2zqwt6z4.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/sfqu1lgr.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_modellisrv4ao/prophet_model-20250730112526.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:25:26,825 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:25:26,838 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:25:26,862 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/kzy22lui.json
2025-07-30 11:25:26,865 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/fi6e75e2.json
2025-07-30 11:25:26,865 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:25:26,865 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:25:26,865 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=39925', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/kzy22lui.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/fi6e75e2.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_modele3vyjv8v/prophet_model-20250730112526.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:25:26,866 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:25:26,880 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:25:26,905 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/ykhqa_uj.json
2025-07-30 11:25:26,908 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/kzansmvb.json
2025-07-30 11:25:26,908 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:25:26,909 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:25:26,909 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=91465', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/ykhqa_uj.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/kzansmvb.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_model4m3myplp/prophet_model-20250730112526.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:25:26,909 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:25:26,923 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:25:26,947 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/sk_u5yc9.json
2025-07-30 11:25:26,950 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/ujj1fiqw.json
2025-07-30 11:25:26,950 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:25:26,950 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:25:26,950 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=99865', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/sk_u5yc9.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/ujj1fiqw.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_modelo3kicwr7/prophet_model-20250730112526.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:25:26,951 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:25:26,967 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:25:26,991 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/kl8uey99.json
2025-07-30 11:25:26,995 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/d1ea42sg.json
2025-07-30 11:25:26,995 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:25:26,995 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:25:26,995 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=44518', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/kl8uey99.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/d1ea42sg.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_model0_35evu5/prophet_model-20250730112526.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:25:26,995 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:25:27,011 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:25:27,035 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/z4m0yv1e.json
2025-07-30 11:25:27,039 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/3xrtp39y.json
2025-07-30 11:25:27,039 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:25:27,039 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:25:27,039 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=77497', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/z4m0yv1e.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/3xrtp39y.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_modelq9jw8408/prophet_model-20250730112527.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:25:27,039 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:25:27,053 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:25:27,079 - src.analytics.predictive - INFO - Prophet CV MAPE: 4.68%
2025-07-30 11:25:27,080 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-30 11:25:27,163 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-30 11:25:27,164 - src.analytics.causal - INFO - Analyzing causal effect of has_promotion on revenue
2025-07-30 11:25:27,175 - dowhy.causal_model - INFO - Model to find the causal effect of treatment ['has_promotion'] on outcome ['revenue']
2025-07-30 11:25:27,175 - dowhy.causal_model - WARNING - There are an additional 10 variables in the dataset that are not in the graph. Variable names are: '['avg_order_value', 'customer_count', 'date', 'hour_of_day', 'location_id', 'location_name', 'new_customer_count', 'order_count', 'repeat_customer_count', 'total_revenue']'
2025-07-30 11:25:27,176 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 11:25:27,177 - dowhy.causal_identifier.auto_identifier - INFO - Instrumental variables for treatment and outcome:[]
2025-07-30 11:25:27,177 - dowhy.causal_identifier.auto_identifier - INFO - Frontdoor variables for treatment and outcome:[]
2025-07-30 11:25:27,177 - dowhy.causal_identifier.auto_identifier - INFO - Number of general adjustment sets found: 1
2025-07-30 11:25:27,177 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 11:25:27,178 - dowhy.causal_model - INFO - propensity_score_matching
2025-07-30 11:25:27,178 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Matching Estimator
2025-07-30 11:25:27,179 - src.analytics.causal - WARNING - PSM estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 11:25:27,179 - dowhy.causal_model - INFO - propensity_score_weighting
2025-07-30 11:25:27,180 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Weighting Estimator
2025-07-30 11:25:27,180 - src.analytics.causal - WARNING - IPW estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 11:25:27,180 - dowhy.causal_model - INFO - linear_regression
2025-07-30 11:25:27,180 - dowhy.causal_estimator - INFO - INFO: Using Linear Regression Estimator
2025-07-30 11:25:27,180 - dowhy.causal_estimator - INFO - b: revenue~has_promotion+is_weekend
2025-07-30 11:25:27,185 - src.analytics.causal - WARNING - Placebo test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 11:25:27,185 - src.analytics.causal - WARNING - Random common cause test failed: CausalModel.refute_estimate() missing 1 required positional argument: 'estimate'
2025-07-30 11:25:27,185 - src.engine.core - INFO - Step 5: Generating optimizations
2025-07-30 11:25:27,186 - src.analytics.optimization - INFO - Optimizing pricing strategy
2025-07-30 11:25:27,187 - src.engine.core - ERROR - Failed to generate pricing optimization: 'item_total_amt'
2025-07-30 11:25:27,187 - src.engine.core - INFO - Step 6: Generating AI insights
2025-07-30 11:25:27,647 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 11:25:32,866 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:25:32,878 - src.engine.core - ERROR - Failed to generate problem diagnosis: 1 validation error for SequentialChain
  Value error, Missing required input keys: {'format_instructions'}, only had {'historical_context', 'decline_analysis', 'factors', 'decline_pct', 'period'} [type=value_error, input_value={'chains': [LLMChain(verb...ions'], 'verbose': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/value_error
2025-07-30 11:25:39,766 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:25:39,769 - src.engine.core - INFO - Daily analysis completed in 13.29 seconds
2025-07-30 11:25:39,845 - src.data.mock_repository - INFO - Generating mock item performance data for 30 days
2025-07-30 11:25:39,856 - src.data.mock_repository - INFO - Generating mock customer segments data
2025-07-30 11:26:06,411 - src.data.mock_repository - INFO - Generating mock time series data for 90 days
2025-07-30 11:26:06,422 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 11:26:06,473 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/40vgn0z5.json
2025-07-30 11:26:06,476 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/kl6gjpyd.json
2025-07-30 11:26:06,477 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:26:06,477 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:26:06,477 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=50361', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/40vgn0z5.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/kl6gjpyd.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_model7rmir60u/prophet_model-20250730112606.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:26:06,477 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:26:06,673 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:26:06,695 - prophet - INFO - Making 3 forecasts with cutoffs between 2025-07-09 11:26:06.413054 and 2025-07-23 11:26:06.413054
2025-07-30 11:26:06,695 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 11:26:06,702 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/xf5xfcbb.json
2025-07-30 11:26:06,704 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/dj21t38c.json
2025-07-30 11:26:06,704 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:26:06,704 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:26:06,704 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=9996', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/xf5xfcbb.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/dj21t38c.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_modelpuugf7lp/prophet_model-20250730112606.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:26:06,704 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:26:06,853 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:26:06,877 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/n50mt0h_.json
2025-07-30 11:26:06,878 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/6oknppf4.json
2025-07-30 11:26:06,879 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:26:06,879 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:26:06,879 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=61241', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/n50mt0h_.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/6oknppf4.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_model1ds0orlk/prophet_model-20250730112606.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:26:06,879 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:26:07,022 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:26:07,045 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/ql7_iolw.json
2025-07-30 11:26:07,047 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/wphqaquf.json
2025-07-30 11:26:07,048 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:26:07,048 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:26:07,048 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=51029', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/ql7_iolw.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/wphqaquf.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp8cscz9og/prophet_modell935u8my/prophet_model-20250730112607.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 11:26:07,048 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:26:07,231 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:26:07,257 - src.analytics.predictive - INFO - Prophet CV MAPE: 13.15%
2025-07-30 11:26:19,105 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 11:26:19,112 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 11:26:20,701 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:26:21,312 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:26:21,765 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:26:21,765 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:26:21,766 - src.data.connectors - ERROR - Failed to convert to DataFrame: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:26:22,360 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:36:56,736 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 11:36:58,970 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:36:59,516 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:36:59,519 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:36:59,989 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:37:00,452 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:37:00,452 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:37:00,452 - src.data.connectors - ERROR - Failed to convert to DataFrame: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:37:01,154 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:37:51,543 - src.llm.agents - INFO - Agent chat query: 如何提升客单价？
2025-07-30 11:37:53,662 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:37:53,673 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:37:53,677 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:37:53,678 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:37:54,550 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:38:48,581 - src.llm.agents - INFO - Agent chat query: 帮我分析下流失客户
2025-07-30 11:38:50,254 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:38:50,314 - src.llm.agents - ERROR - Agent chat failed: AIGrowthAgent._get_churned_customers() takes 1 positional argument but 2 were given
2025-07-30 11:39:56,057 - src.llm.agents - INFO - Agent chat query: 帮我分析下客户分群
2025-07-30 11:39:57,542 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:39:57,577 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:39:58,401 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:41:08,248 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 11:41:26,546 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 11:41:29,622 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:41:30,088 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:41:30,089 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:41:30,089 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:41:30,089 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 11:41:30,539 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:41:31,087 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:41:31,087 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:41:31,088 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:41:31,088 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 11:41:31,671 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:41:32,128 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:41:32,128 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:41:32,128 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:41:32,128 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 11:41:32,129 - src.api.app - INFO - Engine initialized successfully
2025-07-30 11:41:32,139 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 11:41:32,139 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 11:41:32,140 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 11:41:32,140 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:41:32,772 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 11:41:32,778 - src.llm.agents - INFO - Agent chat query: 帮我分析下流失客户
2025-07-30 11:41:35,218 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:41:35,911 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:42:01,467 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 11:42:32,145 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 11:42:35,655 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:42:36,108 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:42:36,108 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:42:36,108 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:42:36,109 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 11:42:36,567 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:42:37,209 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:42:37,209 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:42:37,209 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:42:37,209 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 11:42:37,824 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:42:38,336 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:42:38,336 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:42:38,336 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:42:38,336 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 11:42:38,337 - src.api.app - INFO - Engine initialized successfully
2025-07-30 11:42:38,348 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 11:42:38,348 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 11:42:38,349 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 11:42:38,349 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:42:45,785 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 11:42:45,791 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 11:42:47,449 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:42:48,044 - urllib3.connectionpool - WARNING - Retrying (Retry(total=0, connect=None, read=None, redirect=0, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))': /?
2025-07-30 11:42:48,576 - clickhouse_connect.driver.httpclient - WARNING - Unexpected Http Driver Exception
2025-07-30 11:42:48,576 - src.data.connectors - ERROR - Failed to connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:42:48,576 - src.data.connectors - ERROR - Failed to convert to DataFrame: Cannot connect to ClickHouse: Error HTTPSConnectionPool(host='clickhouse-0-0.umetea.net', port=443): Max retries exceeded with url: /? (Caused by SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1010)'))) executing HTTP request attempt 1 (https://clickhouse-0-0.umetea.net:443)
2025-07-30 11:42:50,036 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:43:17,504 - src.llm.agents - INFO - Agent chat query: 哪些商品需要补货？
2025-07-30 11:43:19,604 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:43:19,641 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:43:20,455 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:44:04,995 - src.llm.agents - INFO - Agent chat query: 近7天的销量如何
2025-07-30 11:44:07,789 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:44:08,035 - src.data.connectors - ERROR - Failed to convert to DataFrame: ClickHouse connection has failed previously
2025-07-30 11:44:08,762 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:55:16,168 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 11:55:38,415 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 11:55:40,914 - src.data.connectors - ERROR - Failed to connect to ClickHouse: HttpClient.__init__() got an unexpected keyword argument 'verify_ssl'
2025-07-30 11:55:40,914 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: HttpClient.__init__() got an unexpected keyword argument 'verify_ssl'
2025-07-30 11:55:40,914 - src.data.mock_repository - INFO - Using mock order repository (no database connection)
2025-07-30 11:55:40,914 - src.data.connectors - ERROR - Failed to connect to ClickHouse: HttpClient.__init__() got an unexpected keyword argument 'verify_ssl'
2025-07-30 11:55:40,914 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: HttpClient.__init__() got an unexpected keyword argument 'verify_ssl'
2025-07-30 11:55:40,914 - src.data.mock_repository - INFO - Using mock customer repository (no database connection)
2025-07-30 11:55:40,914 - src.data.connectors - ERROR - Failed to connect to ClickHouse: HttpClient.__init__() got an unexpected keyword argument 'verify_ssl'
2025-07-30 11:55:40,914 - src.engine.core - WARNING - Failed to connect to database, using mock data: Cannot connect to ClickHouse: HttpClient.__init__() got an unexpected keyword argument 'verify_ssl'
2025-07-30 11:55:40,914 - src.data.mock_repository - INFO - Using mock analytics repository (no database connection)
2025-07-30 11:55:40,914 - src.api.app - INFO - Engine initialized successfully
2025-07-30 11:55:40,915 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 11:55:40,915 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 11:55:40,915 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 11:55:40,915 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:55:43,847 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 11:56:40,922 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 11:56:45,075 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 11:56:46,626 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 11:56:48,301 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 11:56:48,301 - src.api.app - INFO - Engine initialized successfully
2025-07-30 11:56:48,304 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 11:56:48,304 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 11:56:48,305 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 11:56:48,305 - src.api.app - INFO - Scheduler started successfully
2025-07-30 11:58:03,463 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 11:58:03,469 - src.llm.agents - INFO - Agent chat query: 近7天的销量如何
2025-07-30 11:58:05,224 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:58:06,932 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 11:58:08,806 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:58:10,477 - src.llm.agents - INFO - Agent chat query: 近7天的销量如何
2025-07-30 11:58:11,228 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:58:12,354 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:58:17,254 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 11:58:18,396 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:58:19,634 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 400 Bad Request"
2025-07-30 11:58:19,635 - src.llm.azure_client - ERROR - LLM Error: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_jiCX5gmh2pEfSDLMARPFnUZR, call_gr1IMYkln88sBQ8ON9c8Qud3", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 11:58:19,635 - src.llm.agents - ERROR - Agent chat failed: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_jiCX5gmh2pEfSDLMARPFnUZR, call_gr1IMYkln88sBQ8ON9c8Qud3", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 11:58:31,201 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 11:58:33,143 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 11:58:34,318 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 400 Bad Request"
2025-07-30 11:58:34,318 - src.llm.azure_client - ERROR - LLM Error: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_3RSF7ozxTZ4PoXNaInrqbAMK", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 11:58:34,319 - src.llm.agents - ERROR - Agent chat failed: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_3RSF7ozxTZ4PoXNaInrqbAMK", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 11:59:51,851 - src.api.routes - INFO - Running new daily analysis
2025-07-30 11:59:51,852 - src.engine.core - INFO - Starting daily analysis
2025-07-30 11:59:51,852 - src.engine.core - INFO - Step 1: Collecting data
2025-07-30 11:59:55,663 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-30 11:59:55,665 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-30 11:59:55,758 - src.engine.core - ERROR - Failed to detect sales anomalies: unsupported operand type(s) for -: 'float' and 'decimal.Decimal'
2025-07-30 11:59:55,758 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-30 11:59:55,864 - src.engine.core - INFO - Step 3: Running predictions
2025-07-30 11:59:55,864 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 11:59:55,971 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/lw4k9r9q.json
2025-07-30 11:59:55,976 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/za5iron8.json
2025-07-30 11:59:55,976 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:59:55,976 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:59:55,976 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=27526', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/lw4k9r9q.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/za5iron8.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/prophet_modelbohyxaom/prophet_model-20250730115955.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:59:55,976 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:59:56,184 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:59:56,229 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-10 00:00:00 and 2025-07-22 00:00:00
2025-07-30 11:59:56,229 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 11:59:56,239 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/jt4raa87.json
2025-07-30 11:59:56,243 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/u265tdu3.json
2025-07-30 11:59:56,244 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:59:56,244 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:59:56,244 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=67847', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/jt4raa87.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/u265tdu3.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/prophet_model0d0zgpm1/prophet_model-20250730115956.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:59:56,244 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:59:56,262 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:59:56,291 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/h0cuqw0b.json
2025-07-30 11:59:56,294 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/26vxb_8j.json
2025-07-30 11:59:56,295 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:59:56,295 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:59:56,295 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=68337', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/h0cuqw0b.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/26vxb_8j.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/prophet_modeldxr3j0wf/prophet_model-20250730115956.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:59:56,295 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:59:56,316 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:59:56,360 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/2cycjd_f.json
2025-07-30 11:59:56,364 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/extko7qk.json
2025-07-30 11:59:56,364 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:59:56,364 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:59:56,364 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=40404', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/2cycjd_f.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/extko7qk.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/prophet_modelkofipcg3/prophet_model-20250730115956.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:59:56,364 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:59:56,384 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:59:56,413 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/o4y1wk28.json
2025-07-30 11:59:56,416 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/fo6wx4w2.json
2025-07-30 11:59:56,417 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:59:56,417 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:59:56,417 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=87510', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/o4y1wk28.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/fo6wx4w2.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/prophet_modeljqsahxnn/prophet_model-20250730115956.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:59:56,417 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:59:56,475 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:59:56,504 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/w85o1kmc.json
2025-07-30 11:59:56,508 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/lkfh4mdq.json
2025-07-30 11:59:56,509 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:59:56,509 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:59:56,509 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=17268', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/w85o1kmc.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/lkfh4mdq.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/prophet_models9wfy17w/prophet_model-20250730115956.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:59:56,509 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:59:56,529 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:59:56,557 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/ywputyaf.json
2025-07-30 11:59:56,561 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/5rq4aqt3.json
2025-07-30 11:59:56,561 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:59:56,562 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:59:56,562 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=73843', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/ywputyaf.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/5rq4aqt3.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/prophet_modela_rl6nu7/prophet_model-20250730115956.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:59:56,562 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:59:56,582 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:59:56,619 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/da3x3j_n.json
2025-07-30 11:59:56,624 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/u04uh_zj.json
2025-07-30 11:59:56,624 - cmdstanpy - DEBUG - idx 0
2025-07-30 11:59:56,624 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 11:59:56,624 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=9357', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/da3x3j_n.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/u04uh_zj.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpieldhb4a/prophet_modelfo271vdg/prophet_model-20250730115956.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 11:59:56,624 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 11:59:56,656 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 11:59:56,699 - src.analytics.predictive - INFO - Prophet CV MAPE: 2.33%
2025-07-30 11:59:56,702 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-30 11:59:56,705 - src.engine.core - ERROR - Failed to run item demand prediction: unsupported operand type(s) for /: 'decimal.Decimal' and 'float'
2025-07-30 11:59:56,705 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-30 11:59:56,706 - src.analytics.causal - INFO - Analyzing causal effect of has_promotion on revenue
2025-07-30 11:59:56,727 - dowhy.causal_model - INFO - Model to find the causal effect of treatment ['has_promotion'] on outcome ['revenue']
2025-07-30 11:59:56,727 - dowhy.causal_model - WARNING - There are an additional 9 variables in the dataset that are not in the graph. Variable names are: '['avg_order_value', 'customer_count', 'date', 'hour_of_day', 'location_id', 'new_customer_count', 'order_count', 'repeat_customer_count', 'total_revenue']'
2025-07-30 11:59:56,728 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 11:59:56,731 - dowhy.causal_identifier.auto_identifier - INFO - Instrumental variables for treatment and outcome:[]
2025-07-30 11:59:56,731 - dowhy.causal_identifier.auto_identifier - INFO - Frontdoor variables for treatment and outcome:[]
2025-07-30 11:59:56,731 - dowhy.causal_identifier.auto_identifier - INFO - Number of general adjustment sets found: 1
2025-07-30 11:59:56,731 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 11:59:56,733 - dowhy.causal_model - INFO - propensity_score_matching
2025-07-30 11:59:56,735 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Matching Estimator
2025-07-30 11:59:56,739 - src.analytics.causal - WARNING - PSM estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 11:59:56,739 - dowhy.causal_model - INFO - propensity_score_weighting
2025-07-30 11:59:56,740 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Weighting Estimator
2025-07-30 11:59:56,741 - src.analytics.causal - WARNING - IPW estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 11:59:56,741 - dowhy.causal_model - INFO - linear_regression
2025-07-30 11:59:56,741 - dowhy.causal_estimator - INFO - INFO: Using Linear Regression Estimator
2025-07-30 11:59:56,742 - dowhy.causal_estimator - INFO - b: revenue~has_promotion+is_weekend
2025-07-30 11:59:56,742 - src.analytics.causal - WARNING - Linear regression estimation failed: Pandas data cast to numpy dtype of object. Check input data with np.asarray(data).
2025-07-30 11:59:56,742 - src.engine.core - ERROR - Failed to run causal analysis: cannot access local variable 'lr_estimate' where it is not associated with a value
2025-07-30 11:59:56,742 - src.engine.core - INFO - Step 5: Generating optimizations
2025-07-30 11:59:56,747 - src.analytics.optimization - INFO - Optimizing pricing strategy
2025-07-30 11:59:56,781 - src.engine.core - ERROR - Failed to generate pricing optimization: 'item_total_amt'
2025-07-30 11:59:56,781 - src.engine.core - INFO - Step 6: Generating AI insights
2025-07-30 11:59:56,805 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 11:59:59,731 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 12:00:12,340 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 12:00:12,343 - src.engine.core - INFO - Daily analysis completed in 20.49 seconds
2025-07-30 12:00:12,988 - src.api.routes - ERROR - Failed to get item performance: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/api/routes.py", line 365, in get_item_performance
    "performance_score": float(row.get('revenue', 0)) / max_revenue if max_revenue > 0 else 0
                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
TypeError: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
2025-07-30 12:00:20,661 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 12:00:22,813 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 12:00:24,656 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 400 Bad Request"
2025-07-30 12:00:24,657 - src.llm.azure_client - ERROR - LLM Error: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_kdQwo6LMgpv84nyevXSnJGC5, call_jEsqyKpMjwhfYxC1S5wWzL86", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 12:00:24,657 - src.llm.agents - ERROR - Agent chat failed: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_kdQwo6LMgpv84nyevXSnJGC5, call_jEsqyKpMjwhfYxC1S5wWzL86", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 12:01:33,264 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 12:01:35,566 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 12:01:38,178 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 12:01:38,178 - src.api.app - INFO - Engine initialized successfully
2025-07-30 12:01:38,182 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 12:01:38,182 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 12:01:38,182 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 12:01:38,183 - src.api.app - INFO - Scheduler started successfully
2025-07-30 12:01:39,475 - src.api.routes - INFO - Running new daily analysis
2025-07-30 12:01:39,475 - src.engine.core - INFO - Starting daily analysis
2025-07-30 12:01:39,475 - src.engine.core - INFO - Step 1: Collecting data
2025-07-30 12:01:43,199 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-30 12:01:43,200 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-30 12:01:43,307 - src.engine.core - ERROR - Failed to detect sales anomalies: unsupported operand type(s) for -: 'float' and 'decimal.Decimal'
2025-07-30 12:01:43,307 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-30 12:01:43,406 - src.engine.core - INFO - Step 3: Running predictions
2025-07-30 12:01:43,406 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 12:01:43,480 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/2cgeyktz.json
2025-07-30 12:01:43,484 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/kb8eacls.json
2025-07-30 12:01:43,485 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:01:43,485 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:01:43,485 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=84260', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/2cgeyktz.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/kb8eacls.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_modelihh324s5/prophet_model-20250730120143.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 12:01:43,485 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:01:43,528 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:01:43,557 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-10 00:00:00 and 2025-07-22 00:00:00
2025-07-30 12:01:43,557 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 12:01:43,565 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/pkqtl1jp.json
2025-07-30 12:01:43,568 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/c4t5tid3.json
2025-07-30 12:01:43,568 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:01:43,568 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:01:43,568 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=57960', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/pkqtl1jp.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/c4t5tid3.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_modelucxusd10/prophet_model-20250730120143.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 12:01:43,568 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:01:43,586 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:01:43,611 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/pd_k_503.json
2025-07-30 12:01:43,614 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/8hg1k2y8.json
2025-07-30 12:01:43,614 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:01:43,614 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:01:43,614 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=10366', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/pd_k_503.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/8hg1k2y8.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_model24l_smh9/prophet_model-20250730120143.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 12:01:43,614 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:01:43,633 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:01:43,657 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/ozzlp67h.json
2025-07-30 12:01:43,661 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/wbwwv964.json
2025-07-30 12:01:43,661 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:01:43,661 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:01:43,661 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=1022', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/ozzlp67h.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/wbwwv964.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_modelgiz2nvhh/prophet_model-20250730120143.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 12:01:43,661 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:01:43,681 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:01:43,709 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/yhw4n4qj.json
2025-07-30 12:01:43,713 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/q_cq4do5.json
2025-07-30 12:01:43,713 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:01:43,713 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:01:43,713 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=79768', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/yhw4n4qj.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/q_cq4do5.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_model1i1kwn8s/prophet_model-20250730120143.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 12:01:43,713 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:01:43,732 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:01:43,759 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/djomugj2.json
2025-07-30 12:01:43,763 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/_b888dxj.json
2025-07-30 12:01:43,763 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:01:43,763 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:01:43,763 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=29532', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/djomugj2.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/_b888dxj.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_modelljphwmkz/prophet_model-20250730120143.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 12:01:43,763 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:01:43,783 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:01:43,808 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/fhsq48qd.json
2025-07-30 12:01:43,812 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/0dl5ky_6.json
2025-07-30 12:01:43,812 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:01:43,812 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:01:43,812 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=61944', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/fhsq48qd.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/0dl5ky_6.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_model1sp7ieg6/prophet_model-20250730120143.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 12:01:43,812 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:01:43,833 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:01:43,857 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/9sw272l6.json
2025-07-30 12:01:43,861 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/9nhcmwyh.json
2025-07-30 12:01:43,861 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:01:43,861 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:01:43,861 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=21552', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/9sw272l6.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/9nhcmwyh.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_modelfxk2uqhe/prophet_model-20250730120143.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 12:01:43,861 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:01:43,884 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:01:43,911 - src.analytics.predictive - INFO - Prophet CV MAPE: 2.33%
2025-07-30 12:01:43,912 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-30 12:01:43,913 - src.engine.core - ERROR - Failed to run item demand prediction: unsupported operand type(s) for /: 'decimal.Decimal' and 'float'
2025-07-30 12:01:43,913 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-30 12:01:43,914 - src.analytics.causal - INFO - Analyzing causal effect of has_promotion on revenue
2025-07-30 12:01:43,925 - dowhy.causal_model - INFO - Model to find the causal effect of treatment ['has_promotion'] on outcome ['revenue']
2025-07-30 12:01:43,925 - dowhy.causal_model - WARNING - There are an additional 9 variables in the dataset that are not in the graph. Variable names are: '['avg_order_value', 'customer_count', 'date', 'hour_of_day', 'location_id', 'new_customer_count', 'order_count', 'repeat_customer_count', 'total_revenue']'
2025-07-30 12:01:43,926 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 12:01:43,927 - dowhy.causal_identifier.auto_identifier - INFO - Instrumental variables for treatment and outcome:[]
2025-07-30 12:01:43,927 - dowhy.causal_identifier.auto_identifier - INFO - Frontdoor variables for treatment and outcome:[]
2025-07-30 12:01:43,928 - dowhy.causal_identifier.auto_identifier - INFO - Number of general adjustment sets found: 1
2025-07-30 12:01:43,928 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 12:01:43,928 - dowhy.causal_model - INFO - propensity_score_matching
2025-07-30 12:01:43,929 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Matching Estimator
2025-07-30 12:01:43,930 - src.analytics.causal - WARNING - PSM estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 12:01:43,930 - dowhy.causal_model - INFO - propensity_score_weighting
2025-07-30 12:01:43,930 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Weighting Estimator
2025-07-30 12:01:43,931 - src.analytics.causal - WARNING - IPW estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 12:01:43,931 - dowhy.causal_model - INFO - linear_regression
2025-07-30 12:01:43,931 - dowhy.causal_estimator - INFO - INFO: Using Linear Regression Estimator
2025-07-30 12:01:43,931 - dowhy.causal_estimator - INFO - b: revenue~has_promotion+is_weekend
2025-07-30 12:01:43,932 - src.analytics.causal - WARNING - Linear regression estimation failed: Pandas data cast to numpy dtype of object. Check input data with np.asarray(data).
2025-07-30 12:01:43,932 - src.engine.core - ERROR - Failed to run causal analysis: cannot access local variable 'lr_estimate' where it is not associated with a value
2025-07-30 12:01:43,932 - src.engine.core - INFO - Step 5: Generating optimizations
2025-07-30 12:01:43,935 - src.analytics.optimization - INFO - Optimizing pricing strategy
2025-07-30 12:01:43,965 - src.engine.core - ERROR - Failed to generate pricing optimization: 'item_total_amt'
2025-07-30 12:01:43,965 - src.engine.core - INFO - Step 6: Generating AI insights
2025-07-30 12:01:44,432 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 12:01:48,012 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 12:02:01,221 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 12:02:01,225 - src.engine.core - INFO - Daily analysis completed in 21.75 seconds
2025-07-30 12:02:01,439 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 12:02:01,446 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 12:02:03,064 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 12:02:04,953 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 12:02:06,246 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 12:38:15,873 - src.api.routes - ERROR - Failed to get item performance: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/api/routes.py", line 365, in get_item_performance
    "performance_score": float(row.get('revenue', 0)) / max_revenue if max_revenue > 0 else 0
                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
TypeError: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
2025-07-30 12:38:25,241 - src.analytics.predictive - INFO - Starting Prophet prediction for 29 periods
2025-07-30 12:38:25,298 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/baze3vwe.json
2025-07-30 12:38:25,301 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/sxzfm5g1.json
2025-07-30 12:38:25,301 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:38:25,301 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:38:25,301 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=58681', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/baze3vwe.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/sxzfm5g1.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_modelulc2uf9o/prophet_model-20250730123825.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 12:38:25,301 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:38:26,072 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:38:26,097 - prophet - INFO - Making 3 forecasts with cutoffs between 2025-07-08 00:00:00 and 2025-07-22 00:00:00
2025-07-30 12:38:26,097 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 12:38:26,104 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/nn_j_m8u.json
2025-07-30 12:38:26,105 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/xpc51pbh.json
2025-07-30 12:38:26,106 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:38:26,106 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:38:26,106 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=65453', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/nn_j_m8u.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/xpc51pbh.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_model2bxka0v5/prophet_model-20250730123826.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 12:38:26,106 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:38:27,079 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:38:27,103 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/a51wabp1.json
2025-07-30 12:38:27,105 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/6wg135zs.json
2025-07-30 12:38:27,105 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:38:27,105 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:38:27,105 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=23782', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/a51wabp1.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/6wg135zs.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_modelmmsuqa_y/prophet_model-20250730123827.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 12:38:27,105 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:38:27,895 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:38:27,918 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/447_zz5z.json
2025-07-30 12:38:27,920 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/8eojrajx.json
2025-07-30 12:38:27,920 - cmdstanpy - DEBUG - idx 0
2025-07-30 12:38:27,920 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 12:38:27,920 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=72847', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/447_zz5z.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/8eojrajx.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmp3fl5h07e/prophet_model6orqcgfi/prophet_model-20250730123827.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 12:38:27,920 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 12:38:28,749 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 12:38:28,776 - src.analytics.predictive - INFO - Prophet CV MAPE: 4.07%
2025-07-30 13:04:03,146 - src.engine.scheduler - INFO - Running hourly monitoring
2025-07-30 13:31:57,577 - src.llm.agents - INFO - Agent chat query: 哪些商品需要补货？
2025-07-30 13:32:00,528 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 13:32:02,611 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 13:32:30,625 - src.llm.agents - INFO - Agent chat query: 你好
2025-07-30 13:32:32,246 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 13:32:36,532 - src.llm.agents - INFO - Agent chat query: 客户分析
2025-07-30 13:32:37,573 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 13:32:39,236 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 13:32:40,279 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 13:54:47,615 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 13:55:04,788 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 13:55:11,030 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 13:55:13,010 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 13:55:14,801 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 13:55:14,801 - src.api.app - INFO - Engine initialized successfully
2025-07-30 13:55:14,806 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 13:55:14,806 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 13:55:14,806 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 13:55:14,807 - src.api.app - INFO - Scheduler started successfully
2025-07-30 14:11:22,624 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 14:11:22,631 - src.llm.agents - INFO - Agent chat query: 最近一个月什么卖得最好
2025-07-30 14:11:24,403 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:11:26,279 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 14:11:27,786 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:11:29,380 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:11:46,877 - src.llm.agents - INFO - Agent chat query: 为什么它会卖得好
2025-07-30 14:11:48,337 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:11:58,751 - src.llm.agents - INFO - Agent chat query: 什么卖得最差
2025-07-30 14:12:00,388 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:12:01,592 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:13:02,537 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 14:13:04,587 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:13:05,873 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 400 Bad Request"
2025-07-30 14:13:05,875 - src.llm.azure_client - ERROR - LLM Error: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_bHHePiw4tFs0hKCAg9o7wXVm, call_0OV8TxeO5aQC95LQS99fDFJT", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 14:13:05,875 - src.llm.agents - ERROR - Agent chat failed: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_bHHePiw4tFs0hKCAg9o7wXVm, call_0OV8TxeO5aQC95LQS99fDFJT", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 14:13:09,581 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 14:13:11,877 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:13:13,539 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 400 Bad Request"
2025-07-30 14:13:13,540 - src.llm.azure_client - ERROR - LLM Error: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_BwetvoTzFhk96Ckcsj2M7eSR, call_cPQ7pvqiTmUYnBdxa4MRODnK", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 14:13:13,540 - src.llm.agents - ERROR - Agent chat failed: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_BwetvoTzFhk96Ckcsj2M7eSR, call_cPQ7pvqiTmUYnBdxa4MRODnK", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 14:13:16,779 - src.llm.agents - INFO - Agent chat query: 明天需要注意什么？
2025-07-30 14:13:18,399 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:13:21,381 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 14:13:22,473 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 400 Bad Request"
2025-07-30 14:13:22,474 - src.llm.azure_client - ERROR - LLM Error: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_Isto5UzgiWUBVCD56wu4RmoS", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 14:13:22,474 - src.llm.agents - ERROR - Agent chat failed: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_Isto5UzgiWUBVCD56wu4RmoS", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 14:13:40,551 - src.llm.agents - INFO - Agent chat query: 哪些商品需要补货？
2025-07-30 14:13:42,562 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:13:43,921 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:13:57,444 - src.api.routes - INFO - Running new daily analysis
2025-07-30 14:13:57,444 - src.engine.core - INFO - Starting daily analysis
2025-07-30 14:13:57,444 - src.engine.core - INFO - Step 1: Collecting data
2025-07-30 14:14:01,825 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-30 14:14:01,829 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-30 14:14:01,933 - src.engine.core - ERROR - Failed to detect sales anomalies: unsupported operand type(s) for -: 'float' and 'decimal.Decimal'
2025-07-30 14:14:01,933 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-30 14:14:02,034 - src.engine.core - INFO - Step 3: Running predictions
2025-07-30 14:14:02,034 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 14:14:02,245 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/gu5fjbyn.json
2025-07-30 14:14:02,249 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/lsk6xgql.json
2025-07-30 14:14:02,249 - cmdstanpy - DEBUG - idx 0
2025-07-30 14:14:02,249 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 14:14:02,249 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=37788', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/gu5fjbyn.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/lsk6xgql.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/prophet_modelb0ow37kz/prophet_model-20250730141402.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 14:14:02,249 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 14:14:02,464 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 14:14:02,497 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-10 00:00:00 and 2025-07-22 00:00:00
2025-07-30 14:14:02,497 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 14:14:02,505 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/exk6u_dc.json
2025-07-30 14:14:02,508 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/08j0_8gi.json
2025-07-30 14:14:02,508 - cmdstanpy - DEBUG - idx 0
2025-07-30 14:14:02,508 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 14:14:02,508 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=71498', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/exk6u_dc.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/08j0_8gi.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/prophet_model_0e0cda8/prophet_model-20250730141402.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 14:14:02,508 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 14:14:02,532 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 14:14:02,555 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/bglr1zk3.json
2025-07-30 14:14:02,558 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/n6kj6p5w.json
2025-07-30 14:14:02,558 - cmdstanpy - DEBUG - idx 0
2025-07-30 14:14:02,559 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 14:14:02,559 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=10919', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/bglr1zk3.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/n6kj6p5w.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/prophet_modelglkq_wxa/prophet_model-20250730141402.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 14:14:02,559 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 14:14:02,577 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 14:14:02,602 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/unie5cgp.json
2025-07-30 14:14:02,605 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/cxqqr6s1.json
2025-07-30 14:14:02,605 - cmdstanpy - DEBUG - idx 0
2025-07-30 14:14:02,605 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 14:14:02,605 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=12852', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/unie5cgp.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/cxqqr6s1.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/prophet_modelxv_qxwu2/prophet_model-20250730141402.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 14:14:02,605 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 14:14:02,626 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 14:14:02,652 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/mj7ijg09.json
2025-07-30 14:14:02,655 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/1hb2r50l.json
2025-07-30 14:14:02,656 - cmdstanpy - DEBUG - idx 0
2025-07-30 14:14:02,656 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 14:14:02,656 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=19485', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/mj7ijg09.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/1hb2r50l.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/prophet_modelkh8rrhwt/prophet_model-20250730141402.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 14:14:02,656 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 14:14:02,678 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 14:14:02,702 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/8oiqt3pt.json
2025-07-30 14:14:02,706 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/927ynbnc.json
2025-07-30 14:14:02,706 - cmdstanpy - DEBUG - idx 0
2025-07-30 14:14:02,706 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 14:14:02,706 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=4352', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/8oiqt3pt.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/927ynbnc.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/prophet_model5kt4ga_9/prophet_model-20250730141402.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 14:14:02,707 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 14:14:02,728 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 14:14:02,752 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/ranebss3.json
2025-07-30 14:14:02,756 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/kll7ffis.json
2025-07-30 14:14:02,756 - cmdstanpy - DEBUG - idx 0
2025-07-30 14:14:02,756 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 14:14:02,756 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=18570', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/ranebss3.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/kll7ffis.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/prophet_modeltvysaoxo/prophet_model-20250730141402.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 14:14:02,756 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 14:14:02,777 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 14:14:02,801 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/6rl6hzb6.json
2025-07-30 14:14:02,805 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/aibouqky.json
2025-07-30 14:14:02,805 - cmdstanpy - DEBUG - idx 0
2025-07-30 14:14:02,806 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 14:14:02,806 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=32818', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/6rl6hzb6.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/aibouqky.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpgvr0_oq8/prophet_modelwv21ew6u/prophet_model-20250730141402.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 14:14:02,806 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 14:14:02,837 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 14:14:02,866 - src.analytics.predictive - INFO - Prophet CV MAPE: 2.16%
2025-07-30 14:14:02,868 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-30 14:14:02,870 - src.engine.core - ERROR - Failed to run item demand prediction: unsupported operand type(s) for /: 'decimal.Decimal' and 'float'
2025-07-30 14:14:02,870 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-30 14:14:02,871 - src.analytics.causal - INFO - Analyzing causal effect of has_promotion on revenue
2025-07-30 14:14:02,886 - dowhy.causal_model - INFO - Model to find the causal effect of treatment ['has_promotion'] on outcome ['revenue']
2025-07-30 14:14:02,886 - dowhy.causal_model - WARNING - There are an additional 9 variables in the dataset that are not in the graph. Variable names are: '['avg_order_value', 'customer_count', 'date', 'hour_of_day', 'location_id', 'new_customer_count', 'order_count', 'repeat_customer_count', 'total_revenue']'
2025-07-30 14:14:02,886 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 14:14:02,888 - dowhy.causal_identifier.auto_identifier - INFO - Instrumental variables for treatment and outcome:[]
2025-07-30 14:14:02,888 - dowhy.causal_identifier.auto_identifier - INFO - Frontdoor variables for treatment and outcome:[]
2025-07-30 14:14:02,888 - dowhy.causal_identifier.auto_identifier - INFO - Number of general adjustment sets found: 1
2025-07-30 14:14:02,888 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 14:14:02,888 - dowhy.causal_model - INFO - propensity_score_matching
2025-07-30 14:14:02,889 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Matching Estimator
2025-07-30 14:14:02,890 - src.analytics.causal - WARNING - PSM estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 14:14:02,891 - dowhy.causal_model - INFO - propensity_score_weighting
2025-07-30 14:14:02,891 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Weighting Estimator
2025-07-30 14:14:02,891 - src.analytics.causal - WARNING - IPW estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 14:14:02,891 - dowhy.causal_model - INFO - linear_regression
2025-07-30 14:14:02,892 - dowhy.causal_estimator - INFO - INFO: Using Linear Regression Estimator
2025-07-30 14:14:02,892 - dowhy.causal_estimator - INFO - b: revenue~has_promotion+is_weekend
2025-07-30 14:14:02,892 - src.analytics.causal - WARNING - Linear regression estimation failed: Pandas data cast to numpy dtype of object. Check input data with np.asarray(data).
2025-07-30 14:14:02,892 - src.engine.core - ERROR - Failed to run causal analysis: cannot access local variable 'lr_estimate' where it is not associated with a value
2025-07-30 14:14:02,892 - src.engine.core - INFO - Step 5: Generating optimizations
2025-07-30 14:14:02,896 - src.analytics.optimization - INFO - Optimizing pricing strategy
2025-07-30 14:14:02,925 - src.engine.core - ERROR - Failed to generate pricing optimization: 'item_total_amt'
2025-07-30 14:14:02,925 - src.engine.core - INFO - Step 6: Generating AI insights
2025-07-30 14:14:02,942 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 14:14:13,015 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:14:29,418 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:14:29,444 - src.engine.core - INFO - Daily analysis completed in 32.00 seconds
2025-07-30 14:14:29,970 - src.api.routes - ERROR - Failed to get item performance: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/api/routes.py", line 365, in get_item_performance
    "performance_score": float(row.get('revenue', 0)) / max_revenue if max_revenue > 0 else 0
                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
TypeError: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
2025-07-30 14:14:50,468 - src.llm.agents - INFO - Agent chat query: 如何定义高价值客户
2025-07-30 14:14:52,516 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:34:51,099 - src.llm.agents - INFO - Agent chat query: 为什么最近销量下降？
2025-07-30 14:34:53,992 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:34:55,607 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 400 Bad Request"
2025-07-30 14:34:55,608 - src.llm.azure_client - ERROR - LLM Error: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_A7WSaGYL45QARfzFjXJ4K1Xm", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 14:34:55,608 - src.llm.agents - ERROR - Agent chat failed: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_A7WSaGYL45QARfzFjXJ4K1Xm", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 14:35:02,772 - src.llm.agents - INFO - Agent chat query: 哪些商品需要补货？
2025-07-30 14:35:04,893 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:35:06,584 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:35:38,430 - src.llm.agents - INFO - Agent chat query: 为什么近七天销量这么低
2025-07-30 14:35:41,299 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 14:35:42,211 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 400 Bad Request"
2025-07-30 14:35:42,213 - src.llm.azure_client - ERROR - LLM Error: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_hPxR6kqN8jyPjDKlKjANSy4Y", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 14:35:42,213 - src.llm.agents - ERROR - Agent chat failed: Error code: 400 - {'error': {'message': "An assistant message with 'tool_calls' must be followed by tool messages responding to each 'tool_call_id'. The following tool_call_ids did not have response messages: call_hPxR6kqN8jyPjDKlKjANSy4Y", 'type': 'invalid_request_error', 'param': 'messages', 'code': None}}
2025-07-30 14:55:39,703 - src.engine.scheduler - INFO - Running hourly monitoring
2025-07-30 15:09:27,241 - src.llm.agents - INFO - Agent chat query: 你好
2025-07-30 15:09:29,705 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 15:09:37,577 - src.llm.agents - INFO - Agent chat query: 最近7天的销量怎么样
2025-07-30 15:09:39,775 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 15:09:42,074 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 15:09:57,246 - src.llm.agents - INFO - Agent chat query: 什么卖得最好
2025-07-30 15:09:59,609 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 15:10:01,671 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 15:14:57,611 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 15:14:59,732 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 15:15:02,388 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 15:15:02,388 - src.api.app - INFO - Engine initialized successfully
2025-07-30 15:15:02,391 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 15:15:02,391 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 15:15:02,393 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 15:15:02,393 - src.api.app - INFO - Scheduler started successfully
2025-07-30 15:15:02,729 - src.api.routes - INFO - Running new daily analysis
2025-07-30 15:15:02,729 - src.engine.core - INFO - Starting daily analysis
2025-07-30 15:15:02,729 - src.engine.core - INFO - Step 1: Collecting data
2025-07-30 15:15:05,685 - src.engine.core - INFO - Step 2: Detecting anomalies
2025-07-30 15:15:05,691 - src.analytics.anomaly - INFO - Detecting sales anomalies
2025-07-30 15:15:05,788 - src.engine.core - ERROR - Failed to detect sales anomalies: unsupported operand type(s) for -: 'float' and 'decimal.Decimal'
2025-07-30 15:15:05,788 - src.analytics.anomaly - INFO - Detecting pattern changes in y
2025-07-30 15:15:05,908 - src.engine.core - INFO - Step 3: Running predictions
2025-07-30 15:15:05,908 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 15:15:05,993 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/dzq6cbi0.json
2025-07-30 15:15:05,996 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/k1gertzw.json
2025-07-30 15:15:05,997 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:05,997 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:05,997 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=28696', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/dzq6cbi0.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/k1gertzw.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_modelcb_xu12h/prophet_model-20250730151505.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 15:15:05,997 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:06,145 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:06,177 - prophet - INFO - Making 7 forecasts with cutoffs between 2025-06-10 00:00:00 and 2025-07-22 00:00:00
2025-07-30 15:15:06,178 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 15:15:06,185 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/iope2cgm.json
2025-07-30 15:15:06,187 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/r1xyj9z0.json
2025-07-30 15:15:06,188 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:06,188 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:06,188 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=91864', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/iope2cgm.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/r1xyj9z0.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_modelws84fqc_/prophet_model-20250730151506.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 15:15:06,188 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:06,208 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:06,232 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/ro81vbae.json
2025-07-30 15:15:06,235 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/tyels6pf.json
2025-07-30 15:15:06,235 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:06,235 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:06,235 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=87239', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/ro81vbae.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/tyels6pf.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_modelc5tfevwz/prophet_model-20250730151506.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 15:15:06,235 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:06,254 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:06,278 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/peepfjzq.json
2025-07-30 15:15:06,281 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/yhf_d1b3.json
2025-07-30 15:15:06,281 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:06,281 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:06,282 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=39353', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/peepfjzq.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/yhf_d1b3.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_model6qe0yntd/prophet_model-20250730151506.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 15:15:06,282 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:06,299 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:06,324 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/8l71636v.json
2025-07-30 15:15:06,327 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/kr_w9e6b.json
2025-07-30 15:15:06,327 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:06,327 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:06,327 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=16090', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/8l71636v.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/kr_w9e6b.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_model66hpozgz/prophet_model-20250730151506.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 15:15:06,327 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:06,346 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:06,370 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/bp0oagvf.json
2025-07-30 15:15:06,373 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/tow_xgk8.json
2025-07-30 15:15:06,374 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:06,374 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:06,374 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=70975', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/bp0oagvf.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/tow_xgk8.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_modelvmw4_eh4/prophet_model-20250730151506.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 15:15:06,374 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:06,392 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:06,415 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/g4xi8_q4.json
2025-07-30 15:15:06,418 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/xw1nu6ij.json
2025-07-30 15:15:06,418 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:06,418 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:06,418 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=12827', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/g4xi8_q4.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/xw1nu6ij.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_modelnd0ypfdj/prophet_model-20250730151506.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 15:15:06,419 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:06,437 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:06,462 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/4t8ayv5i.json
2025-07-30 15:15:06,466 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/tjg_acbc.json
2025-07-30 15:15:06,466 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:06,466 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:06,466 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=27261', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/4t8ayv5i.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/tjg_acbc.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_model3ro66qd_/prophet_model-20250730151506.csv', 'method=optimize', 'algorithm=lbfgs', 'iter=10000']
2025-07-30 15:15:06,466 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:06,487 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:06,515 - src.analytics.predictive - INFO - Prophet CV MAPE: 2.17%
2025-07-30 15:15:06,517 - src.analytics.predictive - INFO - Starting XGBoost demand prediction
2025-07-30 15:15:06,518 - src.engine.core - ERROR - Failed to run item demand prediction: unsupported operand type(s) for /: 'decimal.Decimal' and 'float'
2025-07-30 15:15:06,518 - src.engine.core - INFO - Step 4: Causal analysis
2025-07-30 15:15:06,520 - src.analytics.causal - INFO - Analyzing causal effect of has_promotion on revenue
2025-07-30 15:15:06,532 - dowhy.causal_model - INFO - Model to find the causal effect of treatment ['has_promotion'] on outcome ['revenue']
2025-07-30 15:15:06,532 - dowhy.causal_model - WARNING - There are an additional 9 variables in the dataset that are not in the graph. Variable names are: '['avg_order_value', 'customer_count', 'date', 'hour_of_day', 'location_id', 'new_customer_count', 'order_count', 'repeat_customer_count', 'total_revenue']'
2025-07-30 15:15:06,532 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 15:15:06,534 - dowhy.causal_identifier.auto_identifier - INFO - Instrumental variables for treatment and outcome:[]
2025-07-30 15:15:06,534 - dowhy.causal_identifier.auto_identifier - INFO - Frontdoor variables for treatment and outcome:[]
2025-07-30 15:15:06,534 - dowhy.causal_identifier.auto_identifier - INFO - Number of general adjustment sets found: 1
2025-07-30 15:15:06,534 - dowhy.causal_identifier.auto_identifier - INFO - Causal effect can be identified.
2025-07-30 15:15:06,534 - dowhy.causal_model - INFO - propensity_score_matching
2025-07-30 15:15:06,535 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Matching Estimator
2025-07-30 15:15:06,536 - src.analytics.causal - WARNING - PSM estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 15:15:06,536 - dowhy.causal_model - INFO - propensity_score_weighting
2025-07-30 15:15:06,536 - dowhy.causal_estimator - INFO - INFO: Using Propensity Score Weighting Estimator
2025-07-30 15:15:06,537 - src.analytics.causal - WARNING - IPW estimation failed: This solver needs samples of at least 2 classes in the data, but the data contains only one class: 0
2025-07-30 15:15:06,537 - dowhy.causal_model - INFO - linear_regression
2025-07-30 15:15:06,537 - dowhy.causal_estimator - INFO - INFO: Using Linear Regression Estimator
2025-07-30 15:15:06,537 - dowhy.causal_estimator - INFO - b: revenue~has_promotion+is_weekend
2025-07-30 15:15:06,538 - src.analytics.causal - WARNING - Linear regression estimation failed: Pandas data cast to numpy dtype of object. Check input data with np.asarray(data).
2025-07-30 15:15:06,538 - src.engine.core - ERROR - Failed to run causal analysis: cannot access local variable 'lr_estimate' where it is not associated with a value
2025-07-30 15:15:06,538 - src.engine.core - INFO - Step 5: Generating optimizations
2025-07-30 15:15:06,542 - src.analytics.optimization - INFO - Optimizing pricing strategy
2025-07-30 15:15:06,568 - src.engine.core - ERROR - Failed to generate pricing optimization: 'item_total_amt'
2025-07-30 15:15:06,568 - src.engine.core - INFO - Step 6: Generating AI insights
2025-07-30 15:15:07,044 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 15:15:10,388 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 15:15:17,475 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 15:15:17,479 - src.engine.core - INFO - Daily analysis completed in 14.75 seconds
2025-07-30 15:15:18,070 - src.api.routes - ERROR - Failed to get item performance: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/api/routes.py", line 365, in get_item_performance
    "performance_score": float(row.get('revenue', 0)) / max_revenue if max_revenue > 0 else 0
                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
TypeError: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
2025-07-30 15:15:26,152 - src.analytics.predictive - INFO - Starting Prophet prediction for 7 periods
2025-07-30 15:15:26,204 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/ddfaz40c.json
2025-07-30 15:15:26,209 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/y0suqydw.json
2025-07-30 15:15:26,210 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:26,210 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:26,210 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=33157', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/ddfaz40c.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/y0suqydw.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_modelcwr4wcrx/prophet_model-20250730151526.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 15:15:26,210 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:26,729 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:26,752 - prophet - INFO - Making 3 forecasts with cutoffs between 2025-07-08 00:00:00 and 2025-07-22 00:00:00
2025-07-30 15:15:26,752 - prophet - WARNING - Seasonality has period of 365.25 days which is larger than initial window. Consider increasing initial.
2025-07-30 15:15:26,758 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/5_upvjl2.json
2025-07-30 15:15:26,760 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/9mbrb01t.json
2025-07-30 15:15:26,761 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:26,761 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:26,761 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=89539', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/5_upvjl2.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/9mbrb01t.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_modelq4g098co/prophet_model-20250730151526.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 15:15:26,761 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:27,727 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:27,752 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/cberlb20.json
2025-07-30 15:15:27,754 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/s5zn2_0j.json
2025-07-30 15:15:27,754 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:27,754 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:27,754 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=21831', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/cberlb20.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/s5zn2_0j.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_modelyyk8r8rw/prophet_model-20250730151527.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 15:15:27,754 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:28,554 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:28,577 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/k2703sr0.json
2025-07-30 15:15:28,579 - cmdstanpy - DEBUG - input tempfile: /var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/1tsrt6ma.json
2025-07-30 15:15:28,580 - cmdstanpy - DEBUG - idx 0
2025-07-30 15:15:28,580 - cmdstanpy - DEBUG - running CmdStan, num_threads: None
2025-07-30 15:15:28,580 - cmdstanpy - DEBUG - CmdStan args: ['/Users/xander/miniconda3/envs/FBR_AI_Engine/lib/python3.12/site-packages/prophet/stan_model/prophet_model.bin', 'random', 'seed=73350', 'data', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/k2703sr0.json', 'init=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/1tsrt6ma.json', 'output', 'file=/var/folders/9_/rff4k37d3vvds76m5ltzbqj00000gp/T/tmpxe30llam/prophet_model6c3nxsmx/prophet_model-20250730151528.csv', 'method=optimize', 'algorithm=newton', 'iter=10000']
2025-07-30 15:15:28,580 - cmdstanpy - INFO - Chain [1] start processing
2025-07-30 15:15:29,404 - cmdstanpy - INFO - Chain [1] done processing
2025-07-30 15:15:29,429 - src.analytics.predictive - INFO - Prophet CV MAPE: 4.14%
2025-07-30 15:16:14,901 - src.api.routes - ERROR - Failed to get item performance: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/api/routes.py", line 365, in get_item_performance
    "performance_score": float(row.get('revenue', 0)) / max_revenue if max_revenue > 0 else 0
                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
TypeError: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
2025-07-30 15:19:47,891 - src.llm.azure_client - INFO - Azure OpenAI client initialized with deployment: gpt-4o-mini
2025-07-30 15:19:47,898 - src.llm.agents - INFO - Agent chat query: 如何提升客单价？
2025-07-30 15:19:49,852 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 15:19:52,001 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 15:19:53,537 - httpx - INFO - HTTP Request: POST https://fbrdev-ai.openai.azure.com/openai/deployments/gpt-4o-mini/chat/completions?api-version=2024-08-01-preview "HTTP/1.1 200 OK"
2025-07-30 15:20:11,665 - src.api.routes - ERROR - Failed to get item performance: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/api/routes.py", line 365, in get_item_performance
    "performance_score": float(row.get('revenue', 0)) / max_revenue if max_revenue > 0 else 0
                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
TypeError: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
2025-07-30 15:21:30,311 - src.api.routes - ERROR - Failed to get item performance: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/api/routes.py", line 365, in get_item_performance
    "performance_score": float(row.get('revenue', 0)) / max_revenue if max_revenue > 0 else 0
                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
TypeError: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
2025-07-30 15:23:26,272 - src.api.routes - ERROR - Failed to get item performance: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
Traceback (most recent call last):
  File "/Users/xander/PycharmProjects/FBR_AI_Agine/src/api/routes.py", line 365, in get_item_performance
    "performance_score": float(row.get('revenue', 0)) / max_revenue if max_revenue > 0 else 0
                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^~~~~~~~~~~~~
TypeError: unsupported operand type(s) for /: 'float' and 'decimal.Decimal'
2025-07-30 16:15:41,645 - src.engine.scheduler - INFO - Running hourly monitoring
2025-07-30 16:58:41,923 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 16:58:42,581 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 16:58:49,889 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 16:58:52,952 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 16:58:56,123 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 16:58:56,123 - src.api.app - INFO - Engine initialized successfully
2025-07-30 16:58:56,127 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 16:58:56,127 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 16:58:56,127 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 16:58:56,127 - src.api.app - INFO - Scheduler started successfully
2025-07-30 17:12:01,300 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 17:12:56,183 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 17:13:00,873 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 17:13:02,981 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 17:13:04,561 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 17:13:04,562 - src.api.app - INFO - Engine initialized successfully
2025-07-30 17:13:04,572 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 17:13:04,572 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 17:13:04,574 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 17:13:04,574 - src.api.app - INFO - Scheduler started successfully
2025-07-30 17:13:51,565 - src.api.app - INFO - Shutting down AI Growth Engine API
2025-07-30 17:14:04,576 - src.engine.scheduler - INFO - Task scheduler stopped
2025-07-30 17:14:09,201 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 17:14:11,288 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 17:14:13,075 - src.data.connectors - INFO - Connected to ClickHouse using clickhouse_connect: clickhouse-0-0.umetea.net:443
2025-07-30 17:14:13,075 - src.api.app - INFO - Engine initialized successfully
2025-07-30 17:14:13,079 - src.engine.scheduler - INFO - Scheduled daily analysis at 08:00
2025-07-30 17:14:13,079 - src.engine.scheduler - INFO - Scheduled hourly monitoring
2025-07-30 17:14:13,080 - src.engine.scheduler - INFO - Task scheduler started
2025-07-30 17:14:13,080 - src.api.app - INFO - Scheduler started successfully
2025-07-30 17:33:53,914 - src.api.app - INFO - Shutting down AI Growth Engine API
